<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>DifferentialEquations.jl · Agents.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="https://fonts.googleapis.com/css?family=Montserrat|Source+Code+Pro&amp;display=swap" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Agents.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">Agents.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../../tutorial/">Tutorial</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../schelling/">Schelling&#39;s segregation model</a></li><li><a class="tocitem" href="../sir/">SIR model for the spread of COVID-19</a></li><li><a class="tocitem" href="../social_distancing/">Continuous space social distancing for COVID-19</a></li><li><a class="tocitem" href="../wealth_distribution/">Wealth distribution</a></li><li><a class="tocitem" href="../forest_fire/">Forest fire</a></li><li><a class="tocitem" href="../game_of_life_2D_CA/">Conway&#39;s game of life</a></li><li><a class="tocitem" href="../wright-fisher/">Wright-Fisher model of evolution</a></li><li><a class="tocitem" href="../HK/">Hegselmann-Krause opinion dynamics</a></li><li><a class="tocitem" href="../flock/">Flocking</a></li><li><a class="tocitem" href="../daisyworld/">Daisyworld</a></li><li><a class="tocitem" href="../predator_prey/">Predator-Prey</a></li><li><a class="tocitem" href="../growing_bacteria/">Bacteria Growth</a></li></ul></li><li><a class="tocitem" href="../../models/">Predefined Models</a></li><li><a class="tocitem" href="../../api/">API</a></li><li><a class="tocitem" href="../../interact/">Interactive application</a></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox" checked/><label class="tocitem" for="menuitem-7"><span class="docs-label">Ecosystem Integration</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>DifferentialEquations.jl</a><ul class="internal"><li><a class="tocitem" href="#Problem-setup"><span>Problem setup</span></a></li><li><a class="tocitem" href="#Coupling-DifferentialEquations.jl-to-Agents.jl"><span>Coupling DifferentialEquations.jl to Agents.jl</span></a></li><li><a class="tocitem" href="#Coupling-Agents.jl-to-DifferentialEquations.jl"><span>Coupling Agents.jl to DifferentialEquations.jl</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../mesa/">Comparison against Mesa (Python)</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Ecosystem Integration</a></li><li class="is-active"><a href>DifferentialEquations.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>DifferentialEquations.jl</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaDynamics/Agents.jl/blob/master/examples/diffeq.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Integrating-Agents.jl-with-DifferentialEquations.jl"><a class="docs-heading-anchor" href="#Integrating-Agents.jl-with-DifferentialEquations.jl">Integrating Agents.jl with DifferentialEquations.jl</a><a id="Integrating-Agents.jl-with-DifferentialEquations.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Integrating-Agents.jl-with-DifferentialEquations.jl" title="Permalink"></a></h1><p>Leveraging other best-in-class packages from the Julia ecosystem is one of the many strengths Agents.jl provides over alternative ABMs.</p><p>The <a href="https://github.com/SciML/DifferentialEquations.jl">DifferentialEquations.jl</a> package is one excellent example. Here, we provide a few ways of leveraging <code>DifferentialEquations</code> to solve agent based models in an efficient and performant manner, whilst mitigating stability issues one may encounter.</p><p>It is common in discrete time step tools (such as <code>Agents</code>) to also discretise equations required for obtaining solutions. In the following example, we use the <a href="https://en.wikipedia.org/wiki/Euler_method">forward Euler method</a> to discretise a logistic function</p><p><span>$\frac{\mathrm{d}s}{\mathrm{d}t} = s \left(1-\frac{s}{120}\right) - h$</span></p><p>into</p><p><span>$s_{t+1} = s_t + s_t (1-s_t/120)-h.$</span></p><p>In this example, <span>$s$</span> denotes some fish <strong>s</strong>tock that increases over time until a maximum population (e.g. 120 here) is met, with the additional property that a <strong>h</strong>arvest (<span>$h$</span>) may also remove some population (we also assume a timestep of 1 normalised unit to simplify things).</p><h2 id="Problem-setup"><a class="docs-heading-anchor" href="#Problem-setup">Problem setup</a><a id="Problem-setup-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-setup" title="Permalink"></a></h2><p>Let&#39;s build a fishing community with fishers, each with differing methods and experience, culminating in a variety of competence when it comes to actually catching fish.</p><pre><code class="language-julia">using Agents
using Distributions
using Plots

mutable struct Fisher &lt;: AbstractAgent
    id::Int
    competence::Int
    yearly_catch::Float64
end

function agent_step!(agent, model)
    # Make sure we sample from the fish distribution
    agent.yearly_catch = rand(Poisson(agent.competence))
end

function dstock(model)
    # Only allow fishing if stocks are high enough
    h = model.stock &gt; model.min_threshold ? sum(a.yearly_catch for a in allagents(model)) :
        0.0

    model.stock * (1 - (model.stock / model.max_population)) - h
end

function model_step!(model)
    model.stock += dstock(model)
end</code></pre><p>These methods should be quite straightforward: each step of the model (<code>agent_step!</code>), every agent will catch some fish based on their competency. There are some safeguards in place to not allow fishers to totally deplete the stock, thus <code>dstock</code> checks the total yearly catch and only harvests if the population is above a minimal threshold (in a more complete example, one should set a flag to state that this year&#39;s catch exceeded the limit and regulate fishing next year, but we&#39;ll ignore this complexity for this example).</p><p>Building this model is simple. Set some initial conditions for the stock, and add agents with some competence.</p><pre><code class="language-julia">function initialise(;
    stock = 5.0, # Initial population of fish
    max_population = 500.0, # Maximum value of fish stock
    min_threshold = 60.0, # Regulate fishing if population drops below this value
    nagents = 50,
)
    model = ABM(
        Fisher;
        properties = Dict(
            :stock =&gt; stock,
            :max_population =&gt; max_population,
            :min_threshold =&gt; min_threshold,
        ),
    )
    for _ in 1:nagents
        add_agent!(
            model,
            # Competence level is a lognormal distribution between 1 and 5
            floor(rand(truncated(LogNormal(), 1, 6))),
            # Yearly catch can start at 0
            0.0,
        )
    end
    model
end</code></pre><p>We can now run the model and see how the fishery fairs over the next 20 years.</p><pre><code class="language-julia">model = initialise()
_, results = run!(model, agent_step!, model_step!, 20; mdata = [:stock])

plot(results.stock; legend = false, ylabel = &quot;Stock&quot;, xlabel = &quot;Year&quot;)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip210">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip210)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip211">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip210)" d="
M224.866 1423.18 L2352.76 1423.18 L2352.76 47.2441 L224.866 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip212">
    <rect x="224" y="47" width="2129" height="1377"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  686.578,1423.18 686.578,47.2441 
  "/>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1188.44,1423.18 1188.44,47.2441 
  "/>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1690.3,1423.18 1690.3,47.2441 
  "/>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2192.16,1423.18 2192.16,47.2441 
  "/>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  224.866,1203 2352.76,1203 
  "/>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  224.866,961.344 2352.76,961.344 
  "/>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  224.866,719.69 2352.76,719.69 
  "/>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  224.866,478.037 2352.76,478.037 
  "/>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  224.866,236.383 2352.76,236.383 
  "/>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  224.866,1423.18 2352.76,1423.18 
  "/>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  224.866,1423.18 224.866,47.2441 
  "/>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  686.578,1423.18 686.578,1406.67 
  "/>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1188.44,1423.18 1188.44,1406.67 
  "/>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1690.3,1423.18 1690.3,1406.67 
  "/>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  2192.16,1423.18 2192.16,1406.67 
  "/>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  224.866,1203 250.401,1203 
  "/>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  224.866,961.344 250.401,961.344 
  "/>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  224.866,719.69 250.401,719.69 
  "/>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  224.866,478.037 250.401,478.037 
  "/>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  224.866,236.383 250.401,236.383 
  "/>
<path clip-path="url(#clip210)" d="M 0 0 M676.856 1442.09 L695.212 1442.09 L695.212 1446.03 L681.138 1446.03 L681.138 1454.5 Q682.157 1454.15 683.175 1453.99 Q684.194 1453.8 685.212 1453.8 Q690.999 1453.8 694.379 1456.98 Q697.759 1460.15 697.759 1465.56 Q697.759 1471.14 694.286 1474.24 Q690.814 1477.32 684.495 1477.32 Q682.319 1477.32 680.05 1476.95 Q677.805 1476.58 675.398 1475.84 L675.398 1471.14 Q677.481 1472.28 679.703 1472.83 Q681.925 1473.39 684.402 1473.39 Q688.407 1473.39 690.745 1471.28 Q693.083 1469.18 693.083 1465.56 Q693.083 1461.95 690.745 1459.85 Q688.407 1457.74 684.402 1457.74 Q682.527 1457.74 680.652 1458.16 Q678.8 1458.57 676.856 1459.45 L676.856 1442.09 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M1165.31 1472.72 L1172.95 1472.72 L1172.95 1446.35 L1164.64 1448.02 L1164.64 1443.76 L1172.91 1442.09 L1177.58 1442.09 L1177.58 1472.72 L1185.22 1472.72 L1185.22 1476.65 L1165.31 1476.65 L1165.31 1472.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M1200.29 1445.17 Q1196.68 1445.17 1194.85 1448.74 Q1193.05 1452.28 1193.05 1459.41 Q1193.05 1466.51 1194.85 1470.08 Q1196.68 1473.62 1200.29 1473.62 Q1203.92 1473.62 1205.73 1470.08 Q1207.56 1466.51 1207.56 1459.41 Q1207.56 1452.28 1205.73 1448.74 Q1203.92 1445.17 1200.29 1445.17 M1200.29 1441.47 Q1206.1 1441.47 1209.16 1446.07 Q1212.24 1450.66 1212.24 1459.41 Q1212.24 1468.13 1209.16 1472.74 Q1206.1 1477.32 1200.29 1477.32 Q1194.48 1477.32 1191.4 1472.74 Q1188.35 1468.13 1188.35 1459.41 Q1188.35 1450.66 1191.4 1446.07 Q1194.48 1441.47 1200.29 1441.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M1667.67 1472.72 L1675.31 1472.72 L1675.31 1446.35 L1667 1448.02 L1667 1443.76 L1675.27 1442.09 L1679.94 1442.09 L1679.94 1472.72 L1687.58 1472.72 L1687.58 1476.65 L1667.67 1476.65 L1667.67 1472.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M1692.7 1442.09 L1711.05 1442.09 L1711.05 1446.03 L1696.98 1446.03 L1696.98 1454.5 Q1698 1454.15 1699.01 1453.99 Q1700.03 1453.8 1701.05 1453.8 Q1706.84 1453.8 1710.22 1456.98 Q1713.6 1460.15 1713.6 1465.56 Q1713.6 1471.14 1710.13 1474.24 Q1706.65 1477.32 1700.33 1477.32 Q1698.16 1477.32 1695.89 1476.95 Q1693.64 1476.58 1691.24 1475.84 L1691.24 1471.14 Q1693.32 1472.28 1695.54 1472.83 Q1697.76 1473.39 1700.24 1473.39 Q1704.25 1473.39 1706.58 1471.28 Q1708.92 1469.18 1708.92 1465.56 Q1708.92 1461.95 1706.58 1459.85 Q1704.25 1457.74 1700.24 1457.74 Q1698.37 1457.74 1696.49 1458.16 Q1694.64 1458.57 1692.7 1459.45 L1692.7 1442.09 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M2173.31 1472.72 L2189.63 1472.72 L2189.63 1476.65 L2167.68 1476.65 L2167.68 1472.72 Q2170.34 1469.96 2174.93 1465.33 Q2179.53 1460.68 2180.71 1459.34 Q2182.96 1456.81 2183.84 1455.08 Q2184.74 1453.32 2184.74 1451.63 Q2184.74 1448.87 2182.8 1447.14 Q2180.88 1445.4 2177.77 1445.4 Q2175.57 1445.4 2173.12 1446.17 Q2170.69 1446.93 2167.91 1448.48 L2167.91 1443.76 Q2170.74 1442.62 2173.19 1442.05 Q2175.64 1441.47 2177.68 1441.47 Q2183.05 1441.47 2186.25 1444.15 Q2189.44 1446.84 2189.44 1451.33 Q2189.44 1453.46 2188.63 1455.38 Q2187.84 1457.28 2185.74 1459.87 Q2185.16 1460.54 2182.06 1463.76 Q2178.95 1466.95 2173.31 1472.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M2204.7 1445.17 Q2201.08 1445.17 2199.26 1448.74 Q2197.45 1452.28 2197.45 1459.41 Q2197.45 1466.51 2199.26 1470.08 Q2201.08 1473.62 2204.7 1473.62 Q2208.33 1473.62 2210.13 1470.08 Q2211.96 1466.51 2211.96 1459.41 Q2211.96 1452.28 2210.13 1448.74 Q2208.33 1445.17 2204.7 1445.17 M2204.7 1441.47 Q2210.51 1441.47 2213.56 1446.07 Q2216.64 1450.66 2216.64 1459.41 Q2216.64 1468.13 2213.56 1472.74 Q2210.51 1477.32 2204.7 1477.32 Q2198.88 1477.32 2195.81 1472.74 Q2192.75 1468.13 2192.75 1459.41 Q2192.75 1450.66 2195.81 1446.07 Q2198.88 1441.47 2204.7 1441.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M157.533 1216.34 L173.852 1216.34 L173.852 1220.28 L151.908 1220.28 L151.908 1216.34 Q154.57 1213.59 159.153 1208.96 Q163.76 1204.31 164.941 1202.96 Q167.186 1200.44 168.065 1198.7 Q168.968 1196.94 168.968 1195.25 Q168.968 1192.5 167.024 1190.76 Q165.103 1189.03 162.001 1189.03 Q159.802 1189.03 157.348 1189.79 Q154.917 1190.56 152.14 1192.11 L152.14 1187.38 Q154.964 1186.25 157.417 1185.67 Q159.871 1185.09 161.908 1185.09 Q167.278 1185.09 170.473 1187.78 Q173.667 1190.46 173.667 1194.95 Q173.667 1197.08 172.857 1199 Q172.07 1200.9 169.964 1203.5 Q169.385 1204.17 166.283 1207.38 Q163.181 1210.58 157.533 1216.34 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M188.922 1188.8 Q185.311 1188.8 183.482 1192.36 Q181.677 1195.9 181.677 1203.03 Q181.677 1210.14 183.482 1213.7 Q185.311 1217.25 188.922 1217.25 Q192.556 1217.25 194.362 1213.7 Q196.19 1210.14 196.19 1203.03 Q196.19 1195.9 194.362 1192.36 Q192.556 1188.8 188.922 1188.8 M188.922 1185.09 Q194.732 1185.09 197.788 1189.7 Q200.866 1194.28 200.866 1203.03 Q200.866 1211.76 197.788 1216.37 Q194.732 1220.95 188.922 1220.95 Q183.112 1220.95 180.033 1216.37 Q176.977 1211.76 176.977 1203.03 Q176.977 1194.28 180.033 1189.7 Q183.112 1185.09 188.922 1185.09 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M164.269 948.138 L152.464 966.587 L164.269 966.587 L164.269 948.138 M163.042 944.064 L168.922 944.064 L168.922 966.587 L173.852 966.587 L173.852 970.476 L168.922 970.476 L168.922 978.624 L164.269 978.624 L164.269 970.476 L148.667 970.476 L148.667 965.962 L163.042 944.064 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M188.922 947.143 Q185.311 947.143 183.482 950.708 Q181.677 954.249 181.677 961.379 Q181.677 968.485 183.482 972.05 Q185.311 975.592 188.922 975.592 Q192.556 975.592 194.362 972.05 Q196.19 968.485 196.19 961.379 Q196.19 954.249 194.362 950.708 Q192.556 947.143 188.922 947.143 M188.922 943.439 Q194.732 943.439 197.788 948.046 Q200.866 952.629 200.866 961.379 Q200.866 970.106 197.788 974.712 Q194.732 979.295 188.922 979.295 Q183.112 979.295 180.033 974.712 Q176.977 970.106 176.977 961.379 Q176.977 952.629 180.033 948.046 Q183.112 943.439 188.922 943.439 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M162.325 717.827 Q159.177 717.827 157.325 719.98 Q155.496 722.132 155.496 725.882 Q155.496 729.609 157.325 731.785 Q159.177 733.938 162.325 733.938 Q165.473 733.938 167.302 731.785 Q169.153 729.609 169.153 725.882 Q169.153 722.132 167.302 719.98 Q165.473 717.827 162.325 717.827 M171.607 703.174 L171.607 707.433 Q169.848 706.6 168.042 706.16 Q166.26 705.721 164.501 705.721 Q159.871 705.721 157.417 708.845 Q154.987 711.97 154.64 718.29 Q156.005 716.276 158.066 715.211 Q160.126 714.123 162.603 714.123 Q167.811 714.123 170.82 717.295 Q173.852 720.443 173.852 725.882 Q173.852 731.206 170.704 734.424 Q167.556 737.642 162.325 737.642 Q156.329 737.642 153.158 733.058 Q149.987 728.452 149.987 719.725 Q149.987 711.531 153.876 706.67 Q157.765 701.785 164.316 701.785 Q166.075 701.785 167.857 702.133 Q169.663 702.48 171.607 703.174 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M188.922 705.489 Q185.311 705.489 183.482 709.054 Q181.677 712.595 181.677 719.725 Q181.677 726.832 183.482 730.396 Q185.311 733.938 188.922 733.938 Q192.556 733.938 194.362 730.396 Q196.19 726.832 196.19 719.725 Q196.19 712.595 194.362 709.054 Q192.556 705.489 188.922 705.489 M188.922 701.785 Q194.732 701.785 197.788 706.392 Q200.866 710.975 200.866 719.725 Q200.866 728.452 197.788 733.058 Q194.732 737.642 188.922 737.642 Q183.112 737.642 180.033 733.058 Q176.977 728.452 176.977 719.725 Q176.977 710.975 180.033 706.392 Q183.112 701.785 188.922 701.785 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M162.001 478.905 Q158.667 478.905 156.746 480.687 Q154.848 482.469 154.848 485.594 Q154.848 488.719 156.746 490.502 Q158.667 492.284 162.001 492.284 Q165.334 492.284 167.255 490.502 Q169.177 488.696 169.177 485.594 Q169.177 482.469 167.255 480.687 Q165.357 478.905 162.001 478.905 M157.325 476.914 Q154.316 476.173 152.626 474.113 Q150.959 472.053 150.959 469.09 Q150.959 464.946 153.899 462.539 Q156.862 460.132 162.001 460.132 Q167.163 460.132 170.103 462.539 Q173.042 464.946 173.042 469.09 Q173.042 472.053 171.353 474.113 Q169.686 476.173 166.7 476.914 Q170.079 477.701 171.954 479.993 Q173.852 482.284 173.852 485.594 Q173.852 490.617 170.774 493.303 Q167.718 495.988 162.001 495.988 Q156.283 495.988 153.204 493.303 Q150.149 490.617 150.149 485.594 Q150.149 482.284 152.047 479.993 Q153.945 477.701 157.325 476.914 M155.612 469.53 Q155.612 472.215 157.279 473.719 Q158.968 475.224 162.001 475.224 Q165.01 475.224 166.7 473.719 Q168.413 472.215 168.413 469.53 Q168.413 466.844 166.7 465.34 Q165.01 463.835 162.001 463.835 Q158.968 463.835 157.279 465.34 Q155.612 466.844 155.612 469.53 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M188.922 463.835 Q185.311 463.835 183.482 467.4 Q181.677 470.942 181.677 478.071 Q181.677 485.178 183.482 488.743 Q185.311 492.284 188.922 492.284 Q192.556 492.284 194.362 488.743 Q196.19 485.178 196.19 478.071 Q196.19 470.942 194.362 467.4 Q192.556 463.835 188.922 463.835 M188.922 460.132 Q194.732 460.132 197.788 464.738 Q200.866 469.321 200.866 478.071 Q200.866 486.798 197.788 491.405 Q194.732 495.988 188.922 495.988 Q183.112 495.988 180.033 491.405 Q176.977 486.798 176.977 478.071 Q176.977 469.321 180.033 464.738 Q183.112 460.132 188.922 460.132 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M126.931 249.728 L134.57 249.728 L134.57 223.362 L126.26 225.029 L126.26 220.769 L134.524 219.103 L139.2 219.103 L139.2 249.728 L146.839 249.728 L146.839 253.663 L126.931 253.663 L126.931 249.728 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M161.908 222.181 Q158.297 222.181 156.468 225.746 Q154.663 229.288 154.663 236.417 Q154.663 243.524 156.468 247.089 Q158.297 250.63 161.908 250.63 Q165.542 250.63 167.348 247.089 Q169.177 243.524 169.177 236.417 Q169.177 229.288 167.348 225.746 Q165.542 222.181 161.908 222.181 M161.908 218.478 Q167.718 218.478 170.774 223.084 Q173.852 227.668 173.852 236.417 Q173.852 245.144 170.774 249.751 Q167.718 254.334 161.908 254.334 Q156.098 254.334 153.019 249.751 Q149.964 245.144 149.964 236.417 Q149.964 227.668 153.019 223.084 Q156.098 218.478 161.908 218.478 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M188.922 222.181 Q185.311 222.181 183.482 225.746 Q181.677 229.288 181.677 236.417 Q181.677 243.524 183.482 247.089 Q185.311 250.63 188.922 250.63 Q192.556 250.63 194.362 247.089 Q196.19 243.524 196.19 236.417 Q196.19 229.288 194.362 225.746 Q192.556 222.181 188.922 222.181 M188.922 218.478 Q194.732 218.478 197.788 223.084 Q200.866 227.668 200.866 236.417 Q200.866 245.144 197.788 249.751 Q194.732 254.334 188.922 254.334 Q183.112 254.334 180.033 249.751 Q176.977 245.144 176.977 236.417 Q176.977 227.668 180.033 223.084 Q183.112 218.478 188.922 218.478 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M1224.37 1508.52 L1231.28 1508.52 L1244.46 1528.07 L1257.54 1508.52 L1264.45 1508.52 L1247.64 1533.41 L1247.64 1556.04 L1241.18 1556.04 L1241.18 1533.41 L1224.37 1508.52 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M1292.42 1536.76 L1292.42 1539.62 L1265.5 1539.62 Q1265.88 1545.67 1269.13 1548.85 Q1272.4 1552 1278.23 1552 Q1281.6 1552 1284.75 1551.17 Q1287.94 1550.35 1291.05 1548.69 L1291.05 1554.23 Q1287.9 1555.57 1284.59 1556.27 Q1281.28 1556.97 1277.88 1556.97 Q1269.35 1556.97 1264.35 1552 Q1259.39 1547.04 1259.39 1538.57 Q1259.39 1529.82 1264.1 1524.69 Q1268.84 1519.54 1276.86 1519.54 Q1284.05 1519.54 1288.22 1524.18 Q1292.42 1528.8 1292.42 1536.76 M1286.57 1535.04 Q1286.5 1530.23 1283.86 1527.37 Q1281.25 1524.5 1276.92 1524.5 Q1272.02 1524.5 1269.06 1527.27 Q1266.13 1530.04 1265.69 1535.07 L1286.57 1535.04 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M1314.77 1538.12 Q1307.67 1538.12 1304.93 1539.75 Q1302.19 1541.37 1302.19 1545.29 Q1302.19 1548.4 1304.23 1550.25 Q1306.3 1552.07 1309.83 1552.07 Q1314.7 1552.07 1317.63 1548.63 Q1320.59 1545.16 1320.59 1539.43 L1320.59 1538.12 L1314.77 1538.12 M1326.45 1535.71 L1326.45 1556.04 L1320.59 1556.04 L1320.59 1550.63 Q1318.59 1553.88 1315.59 1555.44 Q1312.6 1556.97 1308.27 1556.97 Q1302.8 1556.97 1299.55 1553.91 Q1296.34 1550.82 1296.34 1545.67 Q1296.34 1539.65 1300.35 1536.6 Q1304.39 1533.54 1312.38 1533.54 L1320.59 1533.54 L1320.59 1532.97 Q1320.59 1528.93 1317.92 1526.73 Q1315.28 1524.5 1310.47 1524.5 Q1307.41 1524.5 1304.52 1525.23 Q1301.62 1525.97 1298.95 1527.43 L1298.95 1522.02 Q1302.16 1520.78 1305.19 1520.17 Q1308.21 1519.54 1311.08 1519.54 Q1318.81 1519.54 1322.63 1523.55 Q1326.45 1527.56 1326.45 1535.71 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M1353.25 1525.87 Q1352.26 1525.3 1351.08 1525.04 Q1349.94 1524.76 1348.54 1524.76 Q1343.57 1524.76 1340.9 1528 Q1338.26 1531.22 1338.26 1537.27 L1338.26 1556.04 L1332.37 1556.04 L1332.37 1520.4 L1338.26 1520.4 L1338.26 1525.93 Q1340.1 1522.69 1343.06 1521.13 Q1346.02 1519.54 1350.26 1519.54 Q1350.86 1519.54 1351.59 1519.63 Q1352.32 1519.7 1353.22 1519.85 L1353.25 1525.87 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M42.0438 786.185 L48.314 786.185 Q46.5634 789.846 45.704 793.092 Q44.8447 796.339 44.8447 799.362 Q44.8447 804.614 46.8817 807.479 Q48.9187 810.311 52.6745 810.311 Q55.8255 810.311 57.4488 808.434 Q59.0402 806.524 60.0269 801.24 L60.8226 797.357 Q62.1912 790.164 65.6605 786.758 Q69.098 783.321 74.8908 783.321 Q81.7976 783.321 85.3624 787.968 Q88.9272 792.583 88.9272 801.527 Q88.9272 804.901 88.1633 808.72 Q87.3994 812.508 85.9035 816.582 L79.2831 816.582 Q81.4793 812.667 82.5933 808.911 Q83.7073 805.155 83.7073 801.527 Q83.7073 796.02 81.543 793.028 Q79.3786 790.037 75.3682 790.037 Q71.8671 790.037 69.8937 792.201 Q67.9204 794.333 66.9337 799.235 L66.1698 803.15 Q64.7375 810.343 61.682 813.558 Q58.6264 816.773 53.1837 816.773 Q46.8817 816.773 43.2532 812.348 Q39.6248 807.892 39.6248 800.094 Q39.6248 796.752 40.2295 793.283 Q40.8343 789.814 42.0438 786.185 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M42.2347 771.385 L52.3562 771.385 L52.3562 759.322 L56.9077 759.322 L56.9077 771.385 L76.2594 771.385 Q80.6199 771.385 81.8613 770.207 Q83.1026 768.998 83.1026 765.338 L83.1026 759.322 L88.0042 759.322 L88.0042 765.338 Q88.0042 772.117 85.4897 774.695 Q82.9434 777.273 76.2594 777.273 L56.9077 777.273 L56.9077 781.57 L52.3562 781.57 L52.3562 777.273 L42.2347 777.273 L42.2347 771.385 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M56.4621 739.366 Q56.4621 744.076 60.1542 746.813 Q63.8145 749.551 70.212 749.551 Q76.6095 749.551 80.3017 746.845 Q83.9619 744.108 83.9619 739.366 Q83.9619 734.687 80.2698 731.95 Q76.5777 729.212 70.212 729.212 Q63.8781 729.212 60.186 731.95 Q56.4621 734.687 56.4621 739.366 M51.4968 739.366 Q51.4968 731.727 56.4621 727.366 Q61.4273 723.006 70.212 723.006 Q78.9649 723.006 83.9619 727.366 Q88.9272 731.727 88.9272 739.366 Q88.9272 747.036 83.9619 751.397 Q78.9649 755.725 70.212 755.725 Q61.4273 755.725 56.4621 751.397 Q51.4968 747.036 51.4968 739.366 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M53.7248 691.209 L59.1993 691.209 Q57.8307 693.692 57.1623 696.206 Q56.4621 698.689 56.4621 701.235 Q56.4621 706.932 60.0905 710.083 Q63.6872 713.234 70.212 713.234 Q76.7369 713.234 80.3653 710.083 Q83.9619 706.932 83.9619 701.235 Q83.9619 698.689 83.2935 696.206 Q82.5933 693.692 81.2247 691.209 L86.6355 691.209 Q87.7814 693.66 88.3543 696.302 Q88.9272 698.912 88.9272 701.872 Q88.9272 709.924 83.8664 714.667 Q78.8057 719.409 70.212 719.409 Q61.491 719.409 56.4939 714.635 Q51.4968 709.829 51.4968 701.49 Q51.4968 698.784 52.0697 696.206 Q52.6108 693.628 53.7248 691.209 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip210)" d="M 0 0 M38.479 685.289 L38.479 679.401 L67.7294 679.401 L52.3562 661.927 L52.3562 654.447 L69.0344 673.353 L88.0042 653.651 L88.0042 661.29 L70.5939 679.401 L88.0042 679.401 L88.0042 685.289 L38.479 685.289 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip212)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  285.09,1384.24 385.462,1324.43 485.834,1206.6 586.206,977.926 686.578,547.257 786.95,846.44 887.322,307.463 987.695,363.029 1088.07,671.244 1188.44,1120.54 
  1288.81,813.81 1389.18,248.842 1489.56,316.756 1589.93,511.041 1690.3,700.406 1790.67,1074.87 1891.04,727.73 1991.42,95.8851 2091.79,87.35 2192.16,86.1857 
  2292.53,277.703 
  "/>
</svg>
<h3 id="Add-in-some-bureaucracy"><a class="docs-heading-anchor" href="#Add-in-some-bureaucracy">Add in some bureaucracy</a><a id="Add-in-some-bureaucracy-1"></a><a class="docs-heading-anchor-permalink" href="#Add-in-some-bureaucracy" title="Permalink"></a></h3><p>OK, so let&#39;s add in some annoyances for the fishers. Of course, they wish to go out and catch regularly, but regulators only want to do their job once a year! Since it&#39;s the regulators who will monitor the total stock condition and advise fishers as to whether or not they can continue fishing, a systematic blind spot is inadvertently introduced into the system. Yearly catch and regulation occur on one day a year, whilst the stock will of course grow on a daily basis.</p><p>To achieve this, we extend the model like so:</p><pre><code class="language-julia">function agent_step!(agent, model)
    if model.tick % 365 == 0
        agent.yearly_catch = rand(Poisson(agent.competence))
    end
end

function dstock(model)
    # Only allow fishing if stocks are high enough
    # (monitored yearly, so this will return 0 364 days of the year)
    h = model.tick % 365 == 0 &amp;&amp; model.stock &gt; model.min_threshold ?
        sum(a.yearly_catch for a in allagents(model)) : 0.0

    model.stock * (1 - (model.stock / model.max_population)) - h
end

function model_step!(model)
    model.tick += 1
    model.stock += dstock(model)
end

function initialise(;
    stock = 400.0, # Initial population of fish (lets move to an equilibrium position)
    max_population = 500.0, # Maximum value of fish stock
    min_threshold = 60.0, # Regulate fishing if population drops below this value
    nagents = 50,
)
    model = ABM(
        Fisher;
        properties = Dict(
            :stock =&gt; stock,
            :max_population =&gt; max_population,
            :min_threshold =&gt; min_threshold,
            :tick =&gt; 0, # Time keeper in units of days
        ),
    )
    for _ in 1:nagents
        add_agent!(model, floor(rand(truncated(LogNormal(), 1, 6))), 0.0)
    end
    model
end</code></pre><p>Now that our model is running with a daily timestep, we must extend the run length value, and we&#39;ll also start from a steady state population.</p><pre><code class="language-julia">model = initialise()
yearly(model, s) = s % 365 == 0
_, results =
    run!(model, agent_step!, model_step!, 20 * 365; mdata = [:stock], when = yearly)

plot(results.stock; legend = false, ylabel = &quot;Stock&quot;, xlabel = &quot;Year&quot;)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip270">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip270)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip271">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip270)" d="
M229.473 1423.18 L2352.76 1423.18 L2352.76 47.2441 L229.473 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip272">
    <rect x="229" y="47" width="2124" height="1377"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  690.185,1423.18 690.185,47.2441 
  "/>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1190.96,1423.18 1190.96,47.2441 
  "/>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1691.73,1423.18 1691.73,47.2441 
  "/>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2192.51,1423.18 2192.51,47.2441 
  "/>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  229.473,1234.46 2352.76,1234.46 
  "/>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  229.473,984.837 2352.76,984.837 
  "/>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  229.473,735.212 2352.76,735.212 
  "/>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  229.473,485.586 2352.76,485.586 
  "/>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  229.473,235.961 2352.76,235.961 
  "/>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.473,1423.18 2352.76,1423.18 
  "/>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.473,1423.18 229.473,47.2441 
  "/>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  690.185,1423.18 690.185,1406.67 
  "/>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1190.96,1423.18 1190.96,1406.67 
  "/>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1691.73,1423.18 1691.73,1406.67 
  "/>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  2192.51,1423.18 2192.51,1406.67 
  "/>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.473,1234.46 254.952,1234.46 
  "/>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.473,984.837 254.952,984.837 
  "/>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.473,735.212 254.952,735.212 
  "/>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.473,485.586 254.952,485.586 
  "/>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.473,235.961 254.952,235.961 
  "/>
<path clip-path="url(#clip270)" d="M 0 0 M680.463 1442.09 L698.819 1442.09 L698.819 1446.03 L684.745 1446.03 L684.745 1454.5 Q685.764 1454.15 686.782 1453.99 Q687.801 1453.8 688.819 1453.8 Q694.606 1453.8 697.986 1456.98 Q701.366 1460.15 701.366 1465.56 Q701.366 1471.14 697.893 1474.24 Q694.421 1477.32 688.102 1477.32 Q685.926 1477.32 683.657 1476.95 Q681.412 1476.58 679.005 1475.84 L679.005 1471.14 Q681.088 1472.28 683.31 1472.83 Q685.532 1473.39 688.009 1473.39 Q692.014 1473.39 694.352 1471.28 Q696.69 1469.18 696.69 1465.56 Q696.69 1461.95 694.352 1459.85 Q692.014 1457.74 688.009 1457.74 Q686.134 1457.74 684.259 1458.16 Q682.407 1458.57 680.463 1459.45 L680.463 1442.09 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M1167.83 1472.72 L1175.47 1472.72 L1175.47 1446.35 L1167.16 1448.02 L1167.16 1443.76 L1175.43 1442.09 L1180.1 1442.09 L1180.1 1472.72 L1187.74 1472.72 L1187.74 1476.65 L1167.83 1476.65 L1167.83 1472.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M1202.81 1445.17 Q1199.2 1445.17 1197.37 1448.74 Q1195.57 1452.28 1195.57 1459.41 Q1195.57 1466.51 1197.37 1470.08 Q1199.2 1473.62 1202.81 1473.62 Q1206.45 1473.62 1208.25 1470.08 Q1210.08 1466.51 1210.08 1459.41 Q1210.08 1452.28 1208.25 1448.74 Q1206.45 1445.17 1202.81 1445.17 M1202.81 1441.47 Q1208.62 1441.47 1211.68 1446.07 Q1214.76 1450.66 1214.76 1459.41 Q1214.76 1468.13 1211.68 1472.74 Q1208.62 1477.32 1202.81 1477.32 Q1197 1477.32 1193.92 1472.74 Q1190.87 1468.13 1190.87 1459.41 Q1190.87 1450.66 1193.92 1446.07 Q1197 1441.47 1202.81 1441.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M1669.11 1472.72 L1676.75 1472.72 L1676.75 1446.35 L1668.44 1448.02 L1668.44 1443.76 L1676.7 1442.09 L1681.38 1442.09 L1681.38 1472.72 L1689.01 1472.72 L1689.01 1476.65 L1669.11 1476.65 L1669.11 1472.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M1694.13 1442.09 L1712.49 1442.09 L1712.49 1446.03 L1698.41 1446.03 L1698.41 1454.5 Q1699.43 1454.15 1700.45 1453.99 Q1701.47 1453.8 1702.49 1453.8 Q1708.27 1453.8 1711.65 1456.98 Q1715.03 1460.15 1715.03 1465.56 Q1715.03 1471.14 1711.56 1474.24 Q1708.09 1477.32 1701.77 1477.32 Q1699.59 1477.32 1697.32 1476.95 Q1695.08 1476.58 1692.67 1475.84 L1692.67 1471.14 Q1694.75 1472.28 1696.98 1472.83 Q1699.2 1473.39 1701.68 1473.39 Q1705.68 1473.39 1708.02 1471.28 Q1710.36 1469.18 1710.36 1465.56 Q1710.36 1461.95 1708.02 1459.85 Q1705.68 1457.74 1701.68 1457.74 Q1699.8 1457.74 1697.93 1458.16 Q1696.07 1458.57 1694.13 1459.45 L1694.13 1442.09 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M2173.65 1472.72 L2189.97 1472.72 L2189.97 1476.65 L2168.03 1476.65 L2168.03 1472.72 Q2170.69 1469.96 2175.27 1465.33 Q2179.88 1460.68 2181.06 1459.34 Q2183.31 1456.81 2184.19 1455.08 Q2185.09 1453.32 2185.09 1451.63 Q2185.09 1448.87 2183.14 1447.14 Q2181.22 1445.4 2178.12 1445.4 Q2175.92 1445.4 2173.47 1446.17 Q2171.04 1446.93 2168.26 1448.48 L2168.26 1443.76 Q2171.08 1442.62 2173.54 1442.05 Q2175.99 1441.47 2178.03 1441.47 Q2183.4 1441.47 2186.59 1444.15 Q2189.79 1446.84 2189.79 1451.33 Q2189.79 1453.46 2188.98 1455.38 Q2188.19 1457.28 2186.08 1459.87 Q2185.51 1460.54 2182.4 1463.76 Q2179.3 1466.95 2173.65 1472.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M2205.04 1445.17 Q2201.43 1445.17 2199.6 1448.74 Q2197.8 1452.28 2197.8 1459.41 Q2197.8 1466.51 2199.6 1470.08 Q2201.43 1473.62 2205.04 1473.62 Q2208.68 1473.62 2210.48 1470.08 Q2212.31 1466.51 2212.31 1459.41 Q2212.31 1452.28 2210.48 1448.74 Q2208.68 1445.17 2205.04 1445.17 M2205.04 1441.47 Q2210.85 1441.47 2213.91 1446.07 Q2216.99 1450.66 2216.99 1459.41 Q2216.99 1468.13 2213.91 1472.74 Q2210.85 1477.32 2205.04 1477.32 Q2199.23 1477.32 2196.15 1472.74 Q2193.1 1468.13 2193.1 1459.41 Q2193.1 1450.66 2196.15 1446.07 Q2199.23 1441.47 2205.04 1441.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M141.862 1221.26 L130.056 1239.71 L141.862 1239.71 L141.862 1221.26 M140.635 1217.18 L146.515 1217.18 L146.515 1239.71 L151.445 1239.71 L151.445 1243.59 L146.515 1243.59 L146.515 1251.74 L141.862 1251.74 L141.862 1243.59 L126.26 1243.59 L126.26 1239.08 L140.635 1217.18 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M166.515 1220.26 Q162.903 1220.26 161.075 1223.83 Q159.269 1227.37 159.269 1234.5 Q159.269 1241.6 161.075 1245.17 Q162.903 1248.71 166.515 1248.71 Q170.149 1248.71 171.954 1245.17 Q173.783 1241.6 173.783 1234.5 Q173.783 1227.37 171.954 1223.83 Q170.149 1220.26 166.515 1220.26 M166.515 1216.56 Q172.325 1216.56 175.38 1221.16 Q178.459 1225.75 178.459 1234.5 Q178.459 1243.22 175.38 1247.83 Q172.325 1252.41 166.515 1252.41 Q160.704 1252.41 157.626 1247.83 Q154.57 1243.22 154.57 1234.5 Q154.57 1225.75 157.626 1221.16 Q160.704 1216.56 166.515 1216.56 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M193.528 1220.26 Q189.917 1220.26 188.089 1223.83 Q186.283 1227.37 186.283 1234.5 Q186.283 1241.6 188.089 1245.17 Q189.917 1248.71 193.528 1248.71 Q197.163 1248.71 198.968 1245.17 Q200.797 1241.6 200.797 1234.5 Q200.797 1227.37 198.968 1223.83 Q197.163 1220.26 193.528 1220.26 M193.528 1216.56 Q199.338 1216.56 202.394 1221.16 Q205.473 1225.75 205.473 1234.5 Q205.473 1243.22 202.394 1247.83 Q199.338 1252.41 193.528 1252.41 Q187.718 1252.41 184.639 1247.83 Q181.584 1243.22 181.584 1234.5 Q181.584 1225.75 184.639 1221.16 Q187.718 1216.56 193.528 1216.56 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M142.857 971.632 L131.052 990.08 L142.857 990.08 L142.857 971.632 M141.63 967.557 L147.51 967.557 L147.51 990.08 L152.441 990.08 L152.441 993.969 L147.51 993.969 L147.51 1002.12 L142.857 1002.12 L142.857 993.969 L127.256 993.969 L127.256 989.455 L141.63 967.557 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M167.51 970.636 Q163.899 970.636 162.07 974.201 Q160.265 977.743 160.265 984.872 Q160.265 991.979 162.07 995.543 Q163.899 999.085 167.51 999.085 Q171.144 999.085 172.95 995.543 Q174.778 991.979 174.778 984.872 Q174.778 977.743 172.95 974.201 Q171.144 970.636 167.51 970.636 M167.51 966.932 Q173.32 966.932 176.376 971.539 Q179.454 976.122 179.454 984.872 Q179.454 993.599 176.376 998.205 Q173.32 1002.79 167.51 1002.79 Q161.7 1002.79 158.621 998.205 Q155.566 993.599 155.566 984.872 Q155.566 976.122 158.621 971.539 Q161.7 966.932 167.51 966.932 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M184.57 967.557 L202.926 967.557 L202.926 971.493 L188.852 971.493 L188.852 979.965 Q189.871 979.618 190.889 979.456 Q191.908 979.27 192.926 979.27 Q198.713 979.27 202.093 982.442 Q205.473 985.613 205.473 991.03 Q205.473 996.608 202 999.71 Q198.528 1002.79 192.209 1002.79 Q190.033 1002.79 187.764 1002.42 Q185.519 1002.05 183.112 1001.31 L183.112 996.608 Q185.195 997.742 187.417 998.298 Q189.639 998.854 192.116 998.854 Q196.121 998.854 198.459 996.747 Q200.797 994.641 200.797 991.03 Q200.797 987.418 198.459 985.312 Q196.121 983.206 192.116 983.206 Q190.241 983.206 188.366 983.622 Q186.514 984.039 184.57 984.918 L184.57 967.557 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M143.089 722.006 L131.283 740.455 L143.089 740.455 L143.089 722.006 M141.862 717.932 L147.742 717.932 L147.742 740.455 L152.672 740.455 L152.672 744.344 L147.742 744.344 L147.742 752.492 L143.089 752.492 L143.089 744.344 L127.487 744.344 L127.487 739.83 L141.862 717.932 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M158.552 748.557 L166.19 748.557 L166.19 722.191 L157.88 723.858 L157.88 719.599 L166.144 717.932 L170.82 717.932 L170.82 748.557 L178.459 748.557 L178.459 752.492 L158.552 752.492 L158.552 748.557 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M193.528 721.011 Q189.917 721.011 188.089 724.575 Q186.283 728.117 186.283 735.247 Q186.283 742.353 188.089 745.918 Q189.917 749.46 193.528 749.46 Q197.163 749.46 198.968 745.918 Q200.797 742.353 200.797 735.247 Q200.797 728.117 198.968 724.575 Q197.163 721.011 193.528 721.011 M193.528 717.307 Q199.338 717.307 202.394 721.913 Q205.473 726.497 205.473 735.247 Q205.473 743.973 202.394 748.58 Q199.338 753.163 193.528 753.163 Q187.718 753.163 184.639 748.58 Q181.584 743.973 181.584 735.247 Q181.584 726.497 184.639 721.913 Q187.718 717.307 193.528 717.307 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M144.084 472.381 L132.279 490.829 L144.084 490.829 L144.084 472.381 M142.857 468.306 L148.737 468.306 L148.737 490.829 L153.667 490.829 L153.667 494.718 L148.737 494.718 L148.737 502.866 L144.084 502.866 L144.084 494.718 L128.482 494.718 L128.482 490.205 L142.857 468.306 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M159.547 498.931 L167.186 498.931 L167.186 472.566 L158.876 474.232 L158.876 469.973 L167.14 468.306 L171.815 468.306 L171.815 498.931 L179.454 498.931 L179.454 502.866 L159.547 502.866 L159.547 498.931 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M184.57 468.306 L202.926 468.306 L202.926 472.242 L188.852 472.242 L188.852 480.714 Q189.871 480.367 190.889 480.205 Q191.908 480.019 192.926 480.019 Q198.713 480.019 202.093 483.191 Q205.473 486.362 205.473 491.779 Q205.473 497.357 202 500.459 Q198.528 503.538 192.209 503.538 Q190.033 503.538 187.764 503.167 Q185.519 502.797 183.112 502.056 L183.112 497.357 Q185.195 498.491 187.417 499.047 Q189.639 499.603 192.116 499.603 Q196.121 499.603 198.459 497.496 Q200.797 495.39 200.797 491.779 Q200.797 488.167 198.459 486.061 Q196.121 483.955 192.116 483.955 Q190.241 483.955 188.366 484.371 Q186.514 484.788 184.57 485.667 L184.57 468.306 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M143.459 222.755 L131.654 241.204 L143.459 241.204 L143.459 222.755 M142.232 218.681 L148.112 218.681 L148.112 241.204 L153.042 241.204 L153.042 245.093 L148.112 245.093 L148.112 253.241 L143.459 253.241 L143.459 245.093 L127.857 245.093 L127.857 240.579 L142.232 218.681 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M162.14 249.306 L178.459 249.306 L178.459 253.241 L156.515 253.241 L156.515 249.306 Q159.177 246.551 163.76 241.922 Q168.366 237.269 169.547 235.926 Q171.792 233.403 172.672 231.667 Q173.575 229.908 173.575 228.218 Q173.575 225.463 171.63 223.727 Q169.709 221.991 166.607 221.991 Q164.408 221.991 161.954 222.755 Q159.524 223.519 156.746 225.07 L156.746 220.348 Q159.57 219.213 162.024 218.635 Q164.478 218.056 166.515 218.056 Q171.885 218.056 175.079 220.741 Q178.274 223.426 178.274 227.917 Q178.274 230.047 177.464 231.968 Q176.677 233.866 174.57 236.459 Q173.991 237.13 170.89 240.348 Q167.788 243.542 162.14 249.306 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M193.528 221.76 Q189.917 221.76 188.089 225.324 Q186.283 228.866 186.283 235.996 Q186.283 243.102 188.089 246.667 Q189.917 250.209 193.528 250.209 Q197.163 250.209 198.968 246.667 Q200.797 243.102 200.797 235.996 Q200.797 228.866 198.968 225.324 Q197.163 221.76 193.528 221.76 M193.528 218.056 Q199.338 218.056 202.394 222.662 Q205.473 227.246 205.473 235.996 Q205.473 244.722 202.394 249.329 Q199.338 253.912 193.528 253.912 Q187.718 253.912 184.639 249.329 Q181.584 244.722 181.584 235.996 Q181.584 227.246 184.639 222.662 Q187.718 218.056 193.528 218.056 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M1226.68 1508.52 L1233.58 1508.52 L1246.76 1528.07 L1259.84 1508.52 L1266.75 1508.52 L1249.94 1533.41 L1249.94 1556.04 L1243.48 1556.04 L1243.48 1533.41 L1226.68 1508.52 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M1294.73 1536.76 L1294.73 1539.62 L1267.8 1539.62 Q1268.18 1545.67 1271.43 1548.85 Q1274.71 1552 1280.53 1552 Q1283.91 1552 1287.06 1551.17 Q1290.24 1550.35 1293.36 1548.69 L1293.36 1554.23 Q1290.21 1555.57 1286.9 1556.27 Q1283.59 1556.97 1280.18 1556.97 Q1271.65 1556.97 1266.65 1552 Q1261.69 1547.04 1261.69 1538.57 Q1261.69 1529.82 1266.4 1524.69 Q1271.14 1519.54 1279.16 1519.54 Q1286.36 1519.54 1290.53 1524.18 Q1294.73 1528.8 1294.73 1536.76 M1288.87 1535.04 Q1288.81 1530.23 1286.16 1527.37 Q1283.56 1524.5 1279.23 1524.5 Q1274.32 1524.5 1271.36 1527.27 Q1268.44 1530.04 1267.99 1535.07 L1288.87 1535.04 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M1317.07 1538.12 Q1309.97 1538.12 1307.24 1539.75 Q1304.5 1541.37 1304.5 1545.29 Q1304.5 1548.4 1306.54 1550.25 Q1308.6 1552.07 1312.14 1552.07 Q1317.01 1552.07 1319.94 1548.63 Q1322.9 1545.16 1322.9 1539.43 L1322.9 1538.12 L1317.07 1538.12 M1328.75 1535.71 L1328.75 1556.04 L1322.9 1556.04 L1322.9 1550.63 Q1320.89 1553.88 1317.9 1555.44 Q1314.91 1556.97 1310.58 1556.97 Q1305.1 1556.97 1301.86 1553.91 Q1298.64 1550.82 1298.64 1545.67 Q1298.64 1539.65 1302.65 1536.6 Q1306.69 1533.54 1314.68 1533.54 L1322.9 1533.54 L1322.9 1532.97 Q1322.9 1528.93 1320.22 1526.73 Q1317.58 1524.5 1312.77 1524.5 Q1309.72 1524.5 1306.82 1525.23 Q1303.93 1525.97 1301.25 1527.43 L1301.25 1522.02 Q1304.47 1520.78 1307.49 1520.17 Q1310.51 1519.54 1313.38 1519.54 Q1321.11 1519.54 1324.93 1523.55 Q1328.75 1527.56 1328.75 1535.71 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M1355.55 1525.87 Q1354.56 1525.3 1353.39 1525.04 Q1352.24 1524.76 1350.84 1524.76 Q1345.88 1524.76 1343.2 1528 Q1340.56 1531.22 1340.56 1537.27 L1340.56 1556.04 L1334.67 1556.04 L1334.67 1520.4 L1340.56 1520.4 L1340.56 1525.93 Q1342.41 1522.69 1345.37 1521.13 Q1348.33 1519.54 1352.56 1519.54 Q1353.16 1519.54 1353.9 1519.63 Q1354.63 1519.7 1355.52 1519.85 L1355.55 1525.87 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M42.0438 786.185 L48.314 786.185 Q46.5634 789.846 45.704 793.092 Q44.8447 796.339 44.8447 799.362 Q44.8447 804.614 46.8817 807.479 Q48.9187 810.311 52.6745 810.311 Q55.8255 810.311 57.4488 808.434 Q59.0402 806.524 60.0269 801.24 L60.8226 797.357 Q62.1912 790.164 65.6605 786.758 Q69.098 783.321 74.8908 783.321 Q81.7976 783.321 85.3624 787.968 Q88.9272 792.583 88.9272 801.527 Q88.9272 804.901 88.1633 808.72 Q87.3994 812.508 85.9035 816.582 L79.2831 816.582 Q81.4793 812.667 82.5933 808.911 Q83.7073 805.155 83.7073 801.527 Q83.7073 796.02 81.543 793.028 Q79.3786 790.037 75.3682 790.037 Q71.8671 790.037 69.8937 792.201 Q67.9204 794.333 66.9337 799.235 L66.1698 803.15 Q64.7375 810.343 61.682 813.558 Q58.6264 816.773 53.1837 816.773 Q46.8817 816.773 43.2532 812.348 Q39.6248 807.892 39.6248 800.094 Q39.6248 796.752 40.2295 793.283 Q40.8343 789.814 42.0438 786.185 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M42.2347 771.385 L52.3562 771.385 L52.3562 759.322 L56.9077 759.322 L56.9077 771.385 L76.2594 771.385 Q80.6199 771.385 81.8613 770.207 Q83.1026 768.998 83.1026 765.338 L83.1026 759.322 L88.0042 759.322 L88.0042 765.338 Q88.0042 772.117 85.4897 774.695 Q82.9434 777.273 76.2594 777.273 L56.9077 777.273 L56.9077 781.57 L52.3562 781.57 L52.3562 777.273 L42.2347 777.273 L42.2347 771.385 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M56.4621 739.366 Q56.4621 744.076 60.1542 746.813 Q63.8145 749.551 70.212 749.551 Q76.6095 749.551 80.3017 746.845 Q83.9619 744.108 83.9619 739.366 Q83.9619 734.687 80.2698 731.95 Q76.5777 729.212 70.212 729.212 Q63.8781 729.212 60.186 731.95 Q56.4621 734.687 56.4621 739.366 M51.4968 739.366 Q51.4968 731.727 56.4621 727.366 Q61.4273 723.006 70.212 723.006 Q78.9649 723.006 83.9619 727.366 Q88.9272 731.727 88.9272 739.366 Q88.9272 747.036 83.9619 751.397 Q78.9649 755.725 70.212 755.725 Q61.4273 755.725 56.4621 751.397 Q51.4968 747.036 51.4968 739.366 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M53.7248 691.209 L59.1993 691.209 Q57.8307 693.692 57.1623 696.206 Q56.4621 698.689 56.4621 701.235 Q56.4621 706.932 60.0905 710.083 Q63.6872 713.234 70.212 713.234 Q76.7369 713.234 80.3653 710.083 Q83.9619 706.932 83.9619 701.235 Q83.9619 698.689 83.2935 696.206 Q82.5933 693.692 81.2247 691.209 L86.6355 691.209 Q87.7814 693.66 88.3543 696.302 Q88.9272 698.912 88.9272 701.872 Q88.9272 709.924 83.8664 714.667 Q78.8057 719.409 70.212 719.409 Q61.491 719.409 56.4939 714.635 Q51.4968 709.829 51.4968 701.49 Q51.4968 698.784 52.0697 696.206 Q52.6108 693.628 53.7248 691.209 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip270)" d="M 0 0 M38.479 685.289 L38.479 679.401 L67.7294 679.401 L52.3562 661.927 L52.3562 654.447 L69.0344 673.353 L88.0042 653.651 L88.0042 661.29 L70.5939 679.401 L88.0042 679.401 L88.0042 685.289 L38.479 685.289 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip272)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  289.566,1234.46 389.72,685.287 489.875,835.062 590.03,385.736 690.185,785.137 790.34,635.362 890.495,86.1857 990.65,285.886 1090.8,1184.54 1190.96,884.987 
  1291.11,735.212 1391.27,735.212 1491.42,485.586 1591.58,835.062 1691.73,285.886 1791.89,485.586 1892.04,435.661 1992.2,485.586 2092.35,535.512 2192.51,585.437 
  2292.66,1384.24 
  "/>
</svg>
<h3 id="Baseline-benchmark"><a class="docs-heading-anchor" href="#Baseline-benchmark">Baseline benchmark</a><a id="Baseline-benchmark-1"></a><a class="docs-heading-anchor-permalink" href="#Baseline-benchmark" title="Permalink"></a></h3><p>Lets get a baseline performance result for our model.</p><pre><code class="language-julia">using BenchmarkTools

@btime Agents.step!(model, agent_step!, model_step!, 20 * 365) setup =
    (model = initialise())</code></pre><pre><code class="language-none">  17.453 ms (64698 allocations: 1010.91 KiB)</code></pre><p>So this is fairly quick since the model is a simple one, but it&#39;s certainly not as efficient as it could be. We calculate the stock value every single day, since the forward Eulerian method requires us to, so it can evolve correctly. In addition to this, Eulerian expansion introduces uncertainty into our results, which is tied to the choice of step size. For accurate results, one should never really use this approximate method - although it is almost ubiquitous throughout contemporary research code. For a thorough exposé on this, have a read of <a href="https://nextjournal.com/ChrisRackauckas/why-you-shouldnt-use-eulers-method-to-solve-odes">Why you shouldn&#39;t use Eulers method to solve ODEs</a>.</p><h2 id="Coupling-DifferentialEquations.jl-to-Agents.jl"><a class="docs-heading-anchor" href="#Coupling-DifferentialEquations.jl-to-Agents.jl">Coupling DifferentialEquations.jl to Agents.jl</a><a id="Coupling-DifferentialEquations.jl-to-Agents.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Coupling-DifferentialEquations.jl-to-Agents.jl" title="Permalink"></a></h2><p>Lets therefore modify our system to solve the logistic equation in a continuous context, but discretely monitor and harvest.</p><pre><code class="language-julia">import OrdinaryDiffEq

function agent_diffeq_step!(agent, model)
    agent.yearly_catch = rand(Poisson(agent.competence))
end

function model_diffeq_step!(model)
    # We step 364 days with this call.
    OrdinaryDiffEq.step!(model.i, 364.0, true)
    # Only allow fishing if stocks are high enough
    model.i.p[2] =
        model.i.u[1] &gt; model.min_threshold ? sum(a.yearly_catch for a in allagents(model)) :
        0.0
    # Notify the integrator that conditions may be altered
    OrdinaryDiffEq.u_modified!(model.i, true)
    # Then apply our catch modifier
    OrdinaryDiffEq.step!(model.i, 1.0, true)
    # Store yearly stock in the model for plotting
    model.stock = model.i.u[1]
    # And reset for the next year
    model.i.p[2] = 0.0
    OrdinaryDiffEq.u_modified!(model.i, true)
end

function initialise_diffeq(;
    stock = 400.0, # Initial population of fish (lets move to an equilibrium position)
    max_population = 500.0, # Maximum value of fish stock
    min_threshold = 60.0, # Regulate fishing if population drops below this value
    nagents = 50,
)

    function fish_stock!(ds, s, p, t)
        max_population, h = p
        ds[1] = s[1] * (1 - (s[1] / max_population)) - h
    end
    prob =
        OrdinaryDiffEq.ODEProblem(fish_stock!, [stock], (0.0, Inf), [max_population, 0.0])
    integrator = OrdinaryDiffEq.init(prob, OrdinaryDiffEq.Tsit5(); advance_to_tstop = true)

    model = ABM(
        Fisher;
        properties = Dict(
            :stock =&gt; stock,
            :max_population =&gt; max_population,
            :min_threshold =&gt; min_threshold,
            :i =&gt; integrator, # The OrdinaryDiffEq integrator
        ),
    )
    for _ in 1:nagents
        add_agent!(model, floor(rand(truncated(LogNormal(), 1, 6))), 0.0)
    end
    model
end</code></pre><p>Notice that we&#39;ve reverted back to a yearly rather than daily timestep here, since the ODE solver is now in charge of evolving the logistic function forward. We&#39;ve used the <a href="https://docs.sciml.ai/stable/basics/integrator/">integrator interface</a> to achieve this.</p><p>Note that we use <a href="https://github.com/SciML/OrdinaryDiffEq.jl"><code>OrdinaryDiffEq</code></a> here, which is a component of <code>DifferentialEquations</code>. Users may switch this to any subcomponent of the <code>DifferentialEquations</code> ecosystem, or use <code>DifferentialEquations</code> directly. Since we don&#39;t need other components for this example, we&#39;ll stick with the subcomponent but speak in general terms since the packages are interchangable in this context.</p><p>This implementation uses <code>import</code> to explicitly identify which functions are from <code>DifferentialEquations</code> and not <code>Agents</code>. However, since both <code>Agents</code> and <code>DifferentialEquations</code> provide a <code>step!</code> function, each use must be qualified explicitly if one were to choose to bring all of <code>DifferentialEquations</code> into scope via the <code>using</code> keyword.</p><pre><code class="language-julia">modeldeq = initialise_diffeq()
_, resultsdeq = run!(modeldeq, agent_diffeq_step!, model_diffeq_step!, 20; mdata = [:stock])

plot(resultsdeq.stock; legend = false, ylabel = &quot;Stock&quot;, xlabel = &quot;Year&quot;)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip330">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip330)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip331">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip330)" d="
M229.959 1423.18 L2352.76 1423.18 L2352.76 47.2441 L229.959 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip332">
    <rect x="229" y="47" width="2124" height="1377"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip332)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  690.566,1423.18 690.566,47.2441 
  "/>
<polyline clip-path="url(#clip332)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1191.23,1423.18 1191.23,47.2441 
  "/>
<polyline clip-path="url(#clip332)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1691.89,1423.18 1691.89,47.2441 
  "/>
<polyline clip-path="url(#clip332)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2192.54,1423.18 2192.54,47.2441 
  "/>
<polyline clip-path="url(#clip332)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  229.959,1384.24 2352.76,1384.24 
  "/>
<polyline clip-path="url(#clip332)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  229.959,1123.24 2352.76,1123.24 
  "/>
<polyline clip-path="url(#clip332)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  229.959,862.238 2352.76,862.238 
  "/>
<polyline clip-path="url(#clip332)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  229.959,601.237 2352.76,601.237 
  "/>
<polyline clip-path="url(#clip332)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  229.959,340.237 2352.76,340.237 
  "/>
<polyline clip-path="url(#clip332)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  229.959,79.2366 2352.76,79.2366 
  "/>
<polyline clip-path="url(#clip330)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.959,1423.18 2352.76,1423.18 
  "/>
<polyline clip-path="url(#clip330)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.959,1423.18 229.959,47.2441 
  "/>
<polyline clip-path="url(#clip330)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  690.566,1423.18 690.566,1406.67 
  "/>
<polyline clip-path="url(#clip330)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1191.23,1423.18 1191.23,1406.67 
  "/>
<polyline clip-path="url(#clip330)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1691.89,1423.18 1691.89,1406.67 
  "/>
<polyline clip-path="url(#clip330)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  2192.54,1423.18 2192.54,1406.67 
  "/>
<polyline clip-path="url(#clip330)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.959,1384.24 255.432,1384.24 
  "/>
<polyline clip-path="url(#clip330)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.959,1123.24 255.432,1123.24 
  "/>
<polyline clip-path="url(#clip330)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.959,862.238 255.432,862.238 
  "/>
<polyline clip-path="url(#clip330)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.959,601.237 255.432,601.237 
  "/>
<polyline clip-path="url(#clip330)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.959,340.237 255.432,340.237 
  "/>
<polyline clip-path="url(#clip330)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.959,79.2366 255.432,79.2366 
  "/>
<path clip-path="url(#clip330)" d="M 0 0 M680.844 1442.09 L699.2 1442.09 L699.2 1446.03 L685.126 1446.03 L685.126 1454.5 Q686.144 1454.15 687.163 1453.99 Q688.181 1453.8 689.2 1453.8 Q694.987 1453.8 698.367 1456.98 Q701.746 1460.15 701.746 1465.56 Q701.746 1471.14 698.274 1474.24 Q694.802 1477.32 688.482 1477.32 Q686.306 1477.32 684.038 1476.95 Q681.793 1476.58 679.385 1475.84 L679.385 1471.14 Q681.469 1472.28 683.691 1472.83 Q685.913 1473.39 688.39 1473.39 Q692.394 1473.39 694.732 1471.28 Q697.07 1469.18 697.07 1465.56 Q697.07 1461.95 694.732 1459.85 Q692.394 1457.74 688.39 1457.74 Q686.515 1457.74 684.64 1458.16 Q682.788 1458.57 680.844 1459.45 L680.844 1442.09 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M1168.1 1472.72 L1175.74 1472.72 L1175.74 1446.35 L1167.43 1448.02 L1167.43 1443.76 L1175.69 1442.09 L1180.37 1442.09 L1180.37 1472.72 L1188.01 1472.72 L1188.01 1476.65 L1168.1 1476.65 L1168.1 1472.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M1203.08 1445.17 Q1199.47 1445.17 1197.64 1448.74 Q1195.83 1452.28 1195.83 1459.41 Q1195.83 1466.51 1197.64 1470.08 Q1199.47 1473.62 1203.08 1473.62 Q1206.71 1473.62 1208.52 1470.08 Q1210.35 1466.51 1210.35 1459.41 Q1210.35 1452.28 1208.52 1448.74 Q1206.71 1445.17 1203.08 1445.17 M1203.08 1441.47 Q1208.89 1441.47 1211.94 1446.07 Q1215.02 1450.66 1215.02 1459.41 Q1215.02 1468.13 1211.94 1472.74 Q1208.89 1477.32 1203.08 1477.32 Q1197.27 1477.32 1194.19 1472.74 Q1191.13 1468.13 1191.13 1459.41 Q1191.13 1450.66 1194.19 1446.07 Q1197.27 1441.47 1203.08 1441.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M1669.26 1472.72 L1676.9 1472.72 L1676.9 1446.35 L1668.59 1448.02 L1668.59 1443.76 L1676.85 1442.09 L1681.53 1442.09 L1681.53 1472.72 L1689.17 1472.72 L1689.17 1476.65 L1669.26 1476.65 L1669.26 1472.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M1694.28 1442.09 L1712.64 1442.09 L1712.64 1446.03 L1698.56 1446.03 L1698.56 1454.5 Q1699.58 1454.15 1700.6 1453.99 Q1701.62 1453.8 1702.64 1453.8 Q1708.42 1453.8 1711.8 1456.98 Q1715.18 1460.15 1715.18 1465.56 Q1715.18 1471.14 1711.71 1474.24 Q1708.24 1477.32 1701.92 1477.32 Q1699.74 1477.32 1697.48 1476.95 Q1695.23 1476.58 1692.82 1475.84 L1692.82 1471.14 Q1694.91 1472.28 1697.13 1472.83 Q1699.35 1473.39 1701.83 1473.39 Q1705.83 1473.39 1708.17 1471.28 Q1710.51 1469.18 1710.51 1465.56 Q1710.51 1461.95 1708.17 1459.85 Q1705.83 1457.74 1701.83 1457.74 Q1699.95 1457.74 1698.08 1458.16 Q1696.23 1458.57 1694.28 1459.45 L1694.28 1442.09 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M2173.69 1472.72 L2190.01 1472.72 L2190.01 1476.65 L2168.07 1476.65 L2168.07 1472.72 Q2170.73 1469.96 2175.31 1465.33 Q2179.92 1460.68 2181.1 1459.34 Q2183.34 1456.81 2184.22 1455.08 Q2185.13 1453.32 2185.13 1451.63 Q2185.13 1448.87 2183.18 1447.14 Q2181.26 1445.4 2178.16 1445.4 Q2175.96 1445.4 2173.51 1446.17 Q2171.08 1446.93 2168.3 1448.48 L2168.3 1443.76 Q2171.12 1442.62 2173.57 1442.05 Q2176.03 1441.47 2178.07 1441.47 Q2183.44 1441.47 2186.63 1444.15 Q2189.82 1446.84 2189.82 1451.33 Q2189.82 1453.46 2189.01 1455.38 Q2188.23 1457.28 2186.12 1459.87 Q2185.54 1460.54 2182.44 1463.76 Q2179.34 1466.95 2173.69 1472.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M2205.08 1445.17 Q2201.47 1445.17 2199.64 1448.74 Q2197.83 1452.28 2197.83 1459.41 Q2197.83 1466.51 2199.64 1470.08 Q2201.47 1473.62 2205.08 1473.62 Q2208.71 1473.62 2210.52 1470.08 Q2212.35 1466.51 2212.35 1459.41 Q2212.35 1452.28 2210.52 1448.74 Q2208.71 1445.17 2205.08 1445.17 M2205.08 1441.47 Q2210.89 1441.47 2213.95 1446.07 Q2217.02 1450.66 2217.02 1459.41 Q2217.02 1468.13 2213.95 1472.74 Q2210.89 1477.32 2205.08 1477.32 Q2199.27 1477.32 2196.19 1472.74 Q2193.14 1468.13 2193.14 1459.41 Q2193.14 1450.66 2196.19 1446.07 Q2199.27 1441.47 2205.08 1441.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M142.348 1371.03 L130.543 1389.48 L142.348 1389.48 L142.348 1371.03 M141.121 1366.96 L147.001 1366.96 L147.001 1389.48 L151.931 1389.48 L151.931 1393.37 L147.001 1393.37 L147.001 1401.52 L142.348 1401.52 L142.348 1393.37 L126.746 1393.37 L126.746 1388.86 L141.121 1366.96 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M167.001 1370.04 Q163.39 1370.04 161.561 1373.6 Q159.755 1377.14 159.755 1384.27 Q159.755 1391.38 161.561 1394.94 Q163.39 1398.49 167.001 1398.49 Q170.635 1398.49 172.44 1394.94 Q174.269 1391.38 174.269 1384.27 Q174.269 1377.14 172.44 1373.6 Q170.635 1370.04 167.001 1370.04 M167.001 1366.33 Q172.811 1366.33 175.866 1370.94 Q178.945 1375.52 178.945 1384.27 Q178.945 1393 175.866 1397.61 Q172.811 1402.19 167.001 1402.19 Q161.191 1402.19 158.112 1397.61 Q155.056 1393 155.056 1384.27 Q155.056 1375.52 158.112 1370.94 Q161.191 1366.33 167.001 1366.33 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M194.014 1370.04 Q190.403 1370.04 188.575 1373.6 Q186.769 1377.14 186.769 1384.27 Q186.769 1391.38 188.575 1394.94 Q190.403 1398.49 194.014 1398.49 Q197.649 1398.49 199.454 1394.94 Q201.283 1391.38 201.283 1384.27 Q201.283 1377.14 199.454 1373.6 Q197.649 1370.04 194.014 1370.04 M194.014 1366.33 Q199.825 1366.33 202.88 1370.94 Q205.959 1375.52 205.959 1384.27 Q205.959 1393 202.88 1397.61 Q199.825 1402.19 194.014 1402.19 Q188.204 1402.19 185.126 1397.61 Q182.07 1393 182.07 1384.27 Q182.07 1375.52 185.126 1370.94 Q188.204 1366.33 194.014 1366.33 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M143.575 1110.03 L131.769 1128.48 L143.575 1128.48 L143.575 1110.03 M142.348 1105.96 L148.228 1105.96 L148.228 1128.48 L153.158 1128.48 L153.158 1132.37 L148.228 1132.37 L148.228 1140.52 L143.575 1140.52 L143.575 1132.37 L127.973 1132.37 L127.973 1127.86 L142.348 1105.96 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M159.038 1136.58 L166.677 1136.58 L166.677 1110.22 L158.366 1111.88 L158.366 1107.62 L166.63 1105.96 L171.306 1105.96 L171.306 1136.58 L178.945 1136.58 L178.945 1140.52 L159.038 1140.52 L159.038 1136.58 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M194.014 1109.04 Q190.403 1109.04 188.575 1112.6 Q186.769 1116.14 186.769 1123.27 Q186.769 1130.38 188.575 1133.94 Q190.403 1137.49 194.014 1137.49 Q197.649 1137.49 199.454 1133.94 Q201.283 1130.38 201.283 1123.27 Q201.283 1116.14 199.454 1112.6 Q197.649 1109.04 194.014 1109.04 M194.014 1105.33 Q199.825 1105.33 202.88 1109.94 Q205.959 1114.52 205.959 1123.27 Q205.959 1132 202.88 1136.61 Q199.825 1141.19 194.014 1141.19 Q188.204 1141.19 185.126 1136.61 Q182.07 1132 182.07 1123.27 Q182.07 1114.52 185.126 1109.94 Q188.204 1105.33 194.014 1105.33 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M143.945 849.032 L132.14 867.481 L143.945 867.481 L143.945 849.032 M142.718 844.958 L148.598 844.958 L148.598 867.481 L153.529 867.481 L153.529 871.37 L148.598 871.37 L148.598 879.518 L143.945 879.518 L143.945 871.37 L128.343 871.37 L128.343 866.856 L142.718 844.958 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M162.626 875.582 L178.945 875.582 L178.945 879.518 L157.001 879.518 L157.001 875.582 Q159.663 872.828 164.246 868.198 Q168.853 863.545 170.033 862.203 Q172.278 859.68 173.158 857.944 Q174.061 856.184 174.061 854.495 Q174.061 851.74 172.116 850.004 Q170.195 848.268 167.093 848.268 Q164.894 848.268 162.441 849.032 Q160.01 849.796 157.232 851.346 L157.232 846.624 Q160.056 845.49 162.51 844.911 Q164.964 844.333 167.001 844.333 Q172.371 844.333 175.565 847.018 Q178.76 849.703 178.76 854.194 Q178.76 856.323 177.95 858.245 Q177.163 860.143 175.056 862.735 Q174.477 863.407 171.376 866.624 Q168.274 869.819 162.626 875.582 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M194.014 848.036 Q190.403 848.036 188.575 851.601 Q186.769 855.143 186.769 862.272 Q186.769 869.379 188.575 872.944 Q190.403 876.485 194.014 876.485 Q197.649 876.485 199.454 872.944 Q201.283 869.379 201.283 862.272 Q201.283 855.143 199.454 851.601 Q197.649 848.036 194.014 848.036 M194.014 844.333 Q199.825 844.333 202.88 848.939 Q205.959 853.522 205.959 862.272 Q205.959 870.999 202.88 875.606 Q199.825 880.189 194.014 880.189 Q188.204 880.189 185.126 875.606 Q182.07 870.999 182.07 862.272 Q182.07 853.522 185.126 848.939 Q188.204 844.333 194.014 844.333 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M142.996 588.031 L131.191 606.48 L142.996 606.48 L142.996 588.031 M141.769 583.957 L147.649 583.957 L147.649 606.48 L152.579 606.48 L152.579 610.369 L147.649 610.369 L147.649 618.517 L142.996 618.517 L142.996 610.369 L127.394 610.369 L127.394 605.855 L141.769 583.957 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M171.815 599.883 Q175.172 600.601 177.047 602.869 Q178.945 605.138 178.945 608.471 Q178.945 613.587 175.427 616.388 Q171.908 619.189 165.427 619.189 Q163.251 619.189 160.936 618.749 Q158.644 618.332 156.191 617.476 L156.191 612.962 Q158.135 614.096 160.45 614.675 Q162.765 615.253 165.288 615.253 Q169.686 615.253 171.978 613.517 Q174.292 611.781 174.292 608.471 Q174.292 605.416 172.14 603.703 Q170.01 601.966 166.19 601.966 L162.163 601.966 L162.163 598.124 L166.376 598.124 Q169.825 598.124 171.653 596.758 Q173.482 595.369 173.482 592.777 Q173.482 590.115 171.584 588.703 Q169.709 587.267 166.19 587.267 Q164.269 587.267 162.07 587.684 Q159.871 588.101 157.232 588.98 L157.232 584.814 Q159.894 584.073 162.209 583.703 Q164.547 583.332 166.607 583.332 Q171.931 583.332 175.033 585.763 Q178.135 588.17 178.135 592.291 Q178.135 595.161 176.491 597.152 Q174.848 599.119 171.815 599.883 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M194.014 587.036 Q190.403 587.036 188.575 590.601 Q186.769 594.142 186.769 601.272 Q186.769 608.378 188.575 611.943 Q190.403 615.485 194.014 615.485 Q197.649 615.485 199.454 611.943 Q201.283 608.378 201.283 601.272 Q201.283 594.142 199.454 590.601 Q197.649 587.036 194.014 587.036 M194.014 583.332 Q199.825 583.332 202.88 587.939 Q205.959 592.522 205.959 601.272 Q205.959 609.999 202.88 614.605 Q199.825 619.189 194.014 619.189 Q188.204 619.189 185.126 614.605 Q182.07 609.999 182.07 601.272 Q182.07 592.522 185.126 587.939 Q188.204 583.332 194.014 583.332 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M141.862 327.031 L130.056 345.48 L141.862 345.48 L141.862 327.031 M140.635 322.957 L146.515 322.957 L146.515 345.48 L151.445 345.48 L151.445 349.369 L146.515 349.369 L146.515 357.517 L141.862 357.517 L141.862 349.369 L126.26 349.369 L126.26 344.855 L140.635 322.957 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M169.362 327.031 L157.556 345.48 L169.362 345.48 L169.362 327.031 M168.135 322.957 L174.015 322.957 L174.015 345.48 L178.945 345.48 L178.945 349.369 L174.015 349.369 L174.015 357.517 L169.362 357.517 L169.362 349.369 L153.76 349.369 L153.76 344.855 L168.135 322.957 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M194.014 326.036 Q190.403 326.036 188.575 329.6 Q186.769 333.142 186.769 340.272 Q186.769 347.378 188.575 350.943 Q190.403 354.485 194.014 354.485 Q197.649 354.485 199.454 350.943 Q201.283 347.378 201.283 340.272 Q201.283 333.142 199.454 329.6 Q197.649 326.036 194.014 326.036 M194.014 322.332 Q199.825 322.332 202.88 326.938 Q205.959 331.522 205.959 340.272 Q205.959 348.998 202.88 353.605 Q199.825 358.188 194.014 358.188 Q188.204 358.188 185.126 353.605 Q182.07 348.998 182.07 340.272 Q182.07 331.522 185.126 326.938 Q188.204 322.332 194.014 322.332 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M143.343 66.0307 L131.538 84.4797 L143.343 84.4797 L143.343 66.0307 M142.117 61.9566 L147.996 61.9566 L147.996 84.4797 L152.927 84.4797 L152.927 88.3685 L147.996 88.3685 L147.996 96.5166 L143.343 96.5166 L143.343 88.3685 L127.742 88.3685 L127.742 83.8547 L142.117 61.9566 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M158.042 61.9566 L176.399 61.9566 L176.399 65.8918 L162.325 65.8918 L162.325 74.364 Q163.343 74.0168 164.362 73.8547 Q165.38 73.6695 166.399 73.6695 Q172.186 73.6695 175.565 76.8408 Q178.945 80.0121 178.945 85.4287 Q178.945 91.0074 175.473 94.1093 Q172.001 97.1879 165.681 97.1879 Q163.505 97.1879 161.237 96.8176 Q158.991 96.4472 156.584 95.7065 L156.584 91.0074 Q158.667 92.1417 160.89 92.6972 Q163.112 93.2528 165.589 93.2528 Q169.593 93.2528 171.931 91.1463 Q174.269 89.0398 174.269 85.4287 Q174.269 81.8177 171.931 79.7112 Q169.593 77.6047 165.589 77.6047 Q163.714 77.6047 161.839 78.0214 Q159.987 78.438 158.042 79.3177 L158.042 61.9566 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M194.014 65.0353 Q190.403 65.0353 188.575 68.6001 Q186.769 72.1418 186.769 79.2714 Q186.769 86.3778 188.575 89.9426 Q190.403 93.4843 194.014 93.4843 Q197.649 93.4843 199.454 89.9426 Q201.283 86.3778 201.283 79.2714 Q201.283 72.1418 199.454 68.6001 Q197.649 65.0353 194.014 65.0353 M194.014 61.3317 Q199.825 61.3317 202.88 65.9381 Q205.959 70.5214 205.959 79.2714 Q205.959 87.9982 202.88 92.6046 Q199.825 97.1879 194.014 97.1879 Q188.204 97.1879 185.126 92.6046 Q182.07 87.9982 182.07 79.2714 Q182.07 70.5214 185.126 65.9381 Q188.204 61.3317 194.014 61.3317 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M1226.92 1508.52 L1233.83 1508.52 L1247 1528.07 L1260.09 1508.52 L1266.99 1508.52 L1250.19 1533.41 L1250.19 1556.04 L1243.73 1556.04 L1243.73 1533.41 L1226.92 1508.52 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M1294.97 1536.76 L1294.97 1539.62 L1268.04 1539.62 Q1268.42 1545.67 1271.67 1548.85 Q1274.95 1552 1280.77 1552 Q1284.15 1552 1287.3 1551.17 Q1290.48 1550.35 1293.6 1548.69 L1293.6 1554.23 Q1290.45 1555.57 1287.14 1556.27 Q1283.83 1556.97 1280.42 1556.97 Q1271.89 1556.97 1266.9 1552 Q1261.93 1547.04 1261.93 1538.57 Q1261.93 1529.82 1266.64 1524.69 Q1271.38 1519.54 1279.41 1519.54 Q1286.6 1519.54 1290.77 1524.18 Q1294.97 1528.8 1294.97 1536.76 M1289.11 1535.04 Q1289.05 1530.23 1286.41 1527.37 Q1283.8 1524.5 1279.47 1524.5 Q1274.57 1524.5 1271.61 1527.27 Q1268.68 1530.04 1268.23 1535.07 L1289.11 1535.04 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M1317.31 1538.12 Q1310.22 1538.12 1307.48 1539.75 Q1304.74 1541.37 1304.74 1545.29 Q1304.74 1548.4 1306.78 1550.25 Q1308.85 1552.07 1312.38 1552.07 Q1317.25 1552.07 1320.18 1548.63 Q1323.14 1545.16 1323.14 1539.43 L1323.14 1538.12 L1317.31 1538.12 M1328.99 1535.71 L1328.99 1556.04 L1323.14 1556.04 L1323.14 1550.63 Q1321.13 1553.88 1318.14 1555.44 Q1315.15 1556.97 1310.82 1556.97 Q1305.35 1556.97 1302.1 1553.91 Q1298.88 1550.82 1298.88 1545.67 Q1298.88 1539.65 1302.9 1536.6 Q1306.94 1533.54 1314.93 1533.54 L1323.14 1533.54 L1323.14 1532.97 Q1323.14 1528.93 1320.46 1526.73 Q1317.82 1524.5 1313.02 1524.5 Q1309.96 1524.5 1307.06 1525.23 Q1304.17 1525.97 1301.49 1527.43 L1301.49 1522.02 Q1304.71 1520.78 1307.73 1520.17 Q1310.76 1519.54 1313.62 1519.54 Q1321.36 1519.54 1325.18 1523.55 Q1328.99 1527.56 1328.99 1535.71 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M1355.79 1525.87 Q1354.81 1525.3 1353.63 1525.04 Q1352.48 1524.76 1351.08 1524.76 Q1346.12 1524.76 1343.44 1528 Q1340.8 1531.22 1340.8 1537.27 L1340.8 1556.04 L1334.91 1556.04 L1334.91 1520.4 L1340.8 1520.4 L1340.8 1525.93 Q1342.65 1522.69 1345.61 1521.13 Q1348.57 1519.54 1352.8 1519.54 Q1353.41 1519.54 1354.14 1519.63 Q1354.87 1519.7 1355.76 1519.85 L1355.79 1525.87 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M42.0438 786.185 L48.314 786.185 Q46.5634 789.846 45.704 793.092 Q44.8447 796.339 44.8447 799.362 Q44.8447 804.614 46.8817 807.479 Q48.9187 810.311 52.6745 810.311 Q55.8255 810.311 57.4488 808.434 Q59.0402 806.524 60.0269 801.24 L60.8226 797.357 Q62.1912 790.164 65.6605 786.758 Q69.098 783.321 74.8908 783.321 Q81.7976 783.321 85.3624 787.968 Q88.9272 792.583 88.9272 801.527 Q88.9272 804.901 88.1633 808.72 Q87.3994 812.508 85.9035 816.582 L79.2831 816.582 Q81.4793 812.667 82.5933 808.911 Q83.7073 805.155 83.7073 801.527 Q83.7073 796.02 81.543 793.028 Q79.3786 790.037 75.3682 790.037 Q71.8671 790.037 69.8937 792.201 Q67.9204 794.333 66.9337 799.235 L66.1698 803.15 Q64.7375 810.343 61.682 813.558 Q58.6264 816.773 53.1837 816.773 Q46.8817 816.773 43.2532 812.348 Q39.6248 807.892 39.6248 800.094 Q39.6248 796.752 40.2295 793.283 Q40.8343 789.814 42.0438 786.185 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M42.2347 771.385 L52.3562 771.385 L52.3562 759.322 L56.9077 759.322 L56.9077 771.385 L76.2594 771.385 Q80.6199 771.385 81.8613 770.207 Q83.1026 768.998 83.1026 765.338 L83.1026 759.322 L88.0042 759.322 L88.0042 765.338 Q88.0042 772.117 85.4897 774.695 Q82.9434 777.273 76.2594 777.273 L56.9077 777.273 L56.9077 781.57 L52.3562 781.57 L52.3562 777.273 L42.2347 777.273 L42.2347 771.385 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M56.4621 739.366 Q56.4621 744.076 60.1542 746.813 Q63.8145 749.551 70.212 749.551 Q76.6095 749.551 80.3017 746.845 Q83.9619 744.108 83.9619 739.366 Q83.9619 734.687 80.2698 731.95 Q76.5777 729.212 70.212 729.212 Q63.8781 729.212 60.186 731.95 Q56.4621 734.687 56.4621 739.366 M51.4968 739.366 Q51.4968 731.727 56.4621 727.366 Q61.4273 723.006 70.212 723.006 Q78.9649 723.006 83.9619 727.366 Q88.9272 731.727 88.9272 739.366 Q88.9272 747.036 83.9619 751.397 Q78.9649 755.725 70.212 755.725 Q61.4273 755.725 56.4621 751.397 Q51.4968 747.036 51.4968 739.366 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M53.7248 691.209 L59.1993 691.209 Q57.8307 693.692 57.1623 696.206 Q56.4621 698.689 56.4621 701.235 Q56.4621 706.932 60.0905 710.083 Q63.6872 713.234 70.212 713.234 Q76.7369 713.234 80.3653 710.083 Q83.9619 706.932 83.9619 701.235 Q83.9619 698.689 83.2935 696.206 Q82.5933 693.692 81.2247 691.209 L86.6355 691.209 Q87.7814 693.66 88.3543 696.302 Q88.9272 698.912 88.9272 701.872 Q88.9272 709.924 83.8664 714.667 Q78.8057 719.409 70.212 719.409 Q61.491 719.409 56.4939 714.635 Q51.4968 709.829 51.4968 701.49 Q51.4968 698.784 52.0697 696.206 Q52.6108 693.628 53.7248 691.209 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip330)" d="M 0 0 M38.479 685.289 L38.479 679.401 L67.7294 679.401 L52.3562 661.927 L52.3562 654.447 L69.0344 673.353 L88.0042 653.651 L88.0042 661.29 L70.5939 679.401 L88.0042 679.401 L88.0042 685.289 L38.479 685.289 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip332)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  290.038,1384.24 390.17,297.836 490.302,351.453 590.434,191.405 690.566,333.604 790.698,279.921 890.83,86.1857 990.962,156.524 1091.09,476.249 1191.23,368.91 
  1291.36,316.09 1391.49,315.481 1491.62,227.807 1591.75,351.14 1691.89,156.559 1792.02,226.976 1892.15,209.435 1992.28,226.896 2092.41,245.157 2192.54,262.285 
  2292.68,548.616 
  "/>
</svg>
<p>The small complexity addition yields us a generous speed up of around 6x.</p><pre><code class="language-julia">@btime Agents.step!(model, agent_diffeq_step!, model_diffeq_step!, 20) setup =
    (model = initialise_diffeq())</code></pre><pre><code class="language-none">  3.544 ms (127160 allocations: 3.69 MiB)</code></pre><p>Digging into the results a little more, we can see that the <code>DifferentialEquations</code> solver did not need to solve the logistic equation at every agent step to achieve a stable solution for us:</p><pre><code class="language-julia">length(modeldeq.i.sol.t)</code></pre><pre><code class="language-none">2200</code></pre><pre><code class="language-julia">365 * 20 &gt; length(modeldeq.i.sol.t)</code></pre><pre><code class="language-none">true</code></pre><p>With other initial conditions, there&#39;s the possibility that this may not be the case. When this occurs, these additional samples provide mathematical guarantees that the results are accurate (to a given tolerance), which is a safeguard not possible for our Euler example.</p><p>Compare our two results directly, both start with the same random seed and evolve in precisely the same manner:</p><pre><code class="language-julia">plot(results.stock, label = &quot;Euler&quot;, ylabel = &quot;Stock&quot;, xlabel = &quot;Year&quot;)
plot!(resultsdeq.stock, label = &quot;TSit5&quot;)</code></pre><?xml version="1.0" encoding="utf-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600">
<defs>
  <clipPath id="clip390">
    <rect x="0" y="0" width="2400" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip390)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip391">
    <rect x="480" y="0" width="1681" height="1600"/>
  </clipPath>
</defs>
<path clip-path="url(#clip390)" d="
M229.959 1423.18 L2352.76 1423.18 L2352.76 47.2441 L229.959 47.2441  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<defs>
  <clipPath id="clip392">
    <rect x="229" y="47" width="2124" height="1377"/>
  </clipPath>
</defs>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  690.566,1423.18 690.566,47.2441 
  "/>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1191.23,1423.18 1191.23,47.2441 
  "/>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  1691.89,1423.18 1691.89,47.2441 
  "/>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  2192.54,1423.18 2192.54,47.2441 
  "/>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  229.959,1310.39 2352.76,1310.39 
  "/>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  229.959,1064.24 2352.76,1064.24 
  "/>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  229.959,818.088 2352.76,818.088 
  "/>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  229.959,571.936 2352.76,571.936 
  "/>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  229.959,325.784 2352.76,325.784 
  "/>
<polyline clip-path="url(#clip392)" style="stroke:#000000; stroke-width:2; stroke-opacity:0.1; fill:none" points="
  229.959,79.632 2352.76,79.632 
  "/>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.959,1423.18 2352.76,1423.18 
  "/>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.959,1423.18 229.959,47.2441 
  "/>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  690.566,1423.18 690.566,1406.67 
  "/>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1191.23,1423.18 1191.23,1406.67 
  "/>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  1691.89,1423.18 1691.89,1406.67 
  "/>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  2192.54,1423.18 2192.54,1406.67 
  "/>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.959,1310.39 255.432,1310.39 
  "/>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.959,1064.24 255.432,1064.24 
  "/>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.959,818.088 255.432,818.088 
  "/>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.959,571.936 255.432,571.936 
  "/>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.959,325.784 255.432,325.784 
  "/>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  229.959,79.632 255.432,79.632 
  "/>
<path clip-path="url(#clip390)" d="M 0 0 M680.844 1442.09 L699.2 1442.09 L699.2 1446.03 L685.126 1446.03 L685.126 1454.5 Q686.144 1454.15 687.163 1453.99 Q688.181 1453.8 689.2 1453.8 Q694.987 1453.8 698.367 1456.98 Q701.746 1460.15 701.746 1465.56 Q701.746 1471.14 698.274 1474.24 Q694.802 1477.32 688.482 1477.32 Q686.306 1477.32 684.038 1476.95 Q681.793 1476.58 679.385 1475.84 L679.385 1471.14 Q681.469 1472.28 683.691 1472.83 Q685.913 1473.39 688.39 1473.39 Q692.394 1473.39 694.732 1471.28 Q697.07 1469.18 697.07 1465.56 Q697.07 1461.95 694.732 1459.85 Q692.394 1457.74 688.39 1457.74 Q686.515 1457.74 684.64 1458.16 Q682.788 1458.57 680.844 1459.45 L680.844 1442.09 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M1168.1 1472.72 L1175.74 1472.72 L1175.74 1446.35 L1167.43 1448.02 L1167.43 1443.76 L1175.69 1442.09 L1180.37 1442.09 L1180.37 1472.72 L1188.01 1472.72 L1188.01 1476.65 L1168.1 1476.65 L1168.1 1472.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M1203.08 1445.17 Q1199.47 1445.17 1197.64 1448.74 Q1195.83 1452.28 1195.83 1459.41 Q1195.83 1466.51 1197.64 1470.08 Q1199.47 1473.62 1203.08 1473.62 Q1206.71 1473.62 1208.52 1470.08 Q1210.35 1466.51 1210.35 1459.41 Q1210.35 1452.28 1208.52 1448.74 Q1206.71 1445.17 1203.08 1445.17 M1203.08 1441.47 Q1208.89 1441.47 1211.94 1446.07 Q1215.02 1450.66 1215.02 1459.41 Q1215.02 1468.13 1211.94 1472.74 Q1208.89 1477.32 1203.08 1477.32 Q1197.27 1477.32 1194.19 1472.74 Q1191.13 1468.13 1191.13 1459.41 Q1191.13 1450.66 1194.19 1446.07 Q1197.27 1441.47 1203.08 1441.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M1669.26 1472.72 L1676.9 1472.72 L1676.9 1446.35 L1668.59 1448.02 L1668.59 1443.76 L1676.85 1442.09 L1681.53 1442.09 L1681.53 1472.72 L1689.17 1472.72 L1689.17 1476.65 L1669.26 1476.65 L1669.26 1472.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M1694.28 1442.09 L1712.64 1442.09 L1712.64 1446.03 L1698.56 1446.03 L1698.56 1454.5 Q1699.58 1454.15 1700.6 1453.99 Q1701.62 1453.8 1702.64 1453.8 Q1708.42 1453.8 1711.8 1456.98 Q1715.18 1460.15 1715.18 1465.56 Q1715.18 1471.14 1711.71 1474.24 Q1708.24 1477.32 1701.92 1477.32 Q1699.74 1477.32 1697.48 1476.95 Q1695.23 1476.58 1692.82 1475.84 L1692.82 1471.14 Q1694.91 1472.28 1697.13 1472.83 Q1699.35 1473.39 1701.83 1473.39 Q1705.83 1473.39 1708.17 1471.28 Q1710.51 1469.18 1710.51 1465.56 Q1710.51 1461.95 1708.17 1459.85 Q1705.83 1457.74 1701.83 1457.74 Q1699.95 1457.74 1698.08 1458.16 Q1696.23 1458.57 1694.28 1459.45 L1694.28 1442.09 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M2173.69 1472.72 L2190.01 1472.72 L2190.01 1476.65 L2168.07 1476.65 L2168.07 1472.72 Q2170.73 1469.96 2175.31 1465.33 Q2179.92 1460.68 2181.1 1459.34 Q2183.34 1456.81 2184.22 1455.08 Q2185.13 1453.32 2185.13 1451.63 Q2185.13 1448.87 2183.18 1447.14 Q2181.26 1445.4 2178.16 1445.4 Q2175.96 1445.4 2173.51 1446.17 Q2171.08 1446.93 2168.3 1448.48 L2168.3 1443.76 Q2171.12 1442.62 2173.57 1442.05 Q2176.03 1441.47 2178.07 1441.47 Q2183.44 1441.47 2186.63 1444.15 Q2189.82 1446.84 2189.82 1451.33 Q2189.82 1453.46 2189.01 1455.38 Q2188.23 1457.28 2186.12 1459.87 Q2185.54 1460.54 2182.44 1463.76 Q2179.34 1466.95 2173.69 1472.72 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M2205.08 1445.17 Q2201.47 1445.17 2199.64 1448.74 Q2197.83 1452.28 2197.83 1459.41 Q2197.83 1466.51 2199.64 1470.08 Q2201.47 1473.62 2205.08 1473.62 Q2208.71 1473.62 2210.52 1470.08 Q2212.35 1466.51 2212.35 1459.41 Q2212.35 1452.28 2210.52 1448.74 Q2208.71 1445.17 2205.08 1445.17 M2205.08 1441.47 Q2210.89 1441.47 2213.95 1446.07 Q2217.02 1450.66 2217.02 1459.41 Q2217.02 1468.13 2213.95 1472.74 Q2210.89 1477.32 2205.08 1477.32 Q2199.27 1477.32 2196.19 1472.74 Q2193.14 1468.13 2193.14 1459.41 Q2193.14 1450.66 2196.19 1446.07 Q2199.27 1441.47 2205.08 1441.47 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M142.348 1297.19 L130.543 1315.64 L142.348 1315.64 L142.348 1297.19 M141.121 1293.11 L147.001 1293.11 L147.001 1315.64 L151.931 1315.64 L151.931 1319.52 L147.001 1319.52 L147.001 1327.67 L142.348 1327.67 L142.348 1319.52 L126.746 1319.52 L126.746 1315.01 L141.121 1293.11 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M167.001 1296.19 Q163.39 1296.19 161.561 1299.76 Q159.755 1303.3 159.755 1310.43 Q159.755 1317.53 161.561 1321.1 Q163.39 1324.64 167.001 1324.64 Q170.635 1324.64 172.44 1321.1 Q174.269 1317.53 174.269 1310.43 Q174.269 1303.3 172.44 1299.76 Q170.635 1296.19 167.001 1296.19 M167.001 1292.49 Q172.811 1292.49 175.866 1297.09 Q178.945 1301.68 178.945 1310.43 Q178.945 1319.15 175.866 1323.76 Q172.811 1328.34 167.001 1328.34 Q161.191 1328.34 158.112 1323.76 Q155.056 1319.15 155.056 1310.43 Q155.056 1301.68 158.112 1297.09 Q161.191 1292.49 167.001 1292.49 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M194.014 1296.19 Q190.403 1296.19 188.575 1299.76 Q186.769 1303.3 186.769 1310.43 Q186.769 1317.53 188.575 1321.1 Q190.403 1324.64 194.014 1324.64 Q197.649 1324.64 199.454 1321.1 Q201.283 1317.53 201.283 1310.43 Q201.283 1303.3 199.454 1299.76 Q197.649 1296.19 194.014 1296.19 M194.014 1292.49 Q199.825 1292.49 202.88 1297.09 Q205.959 1301.68 205.959 1310.43 Q205.959 1319.15 202.88 1323.76 Q199.825 1328.34 194.014 1328.34 Q188.204 1328.34 185.126 1323.76 Q182.07 1319.15 182.07 1310.43 Q182.07 1301.68 185.126 1297.09 Q188.204 1292.49 194.014 1292.49 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M143.575 1051.03 L131.769 1069.48 L143.575 1069.48 L143.575 1051.03 M142.348 1046.96 L148.228 1046.96 L148.228 1069.48 L153.158 1069.48 L153.158 1073.37 L148.228 1073.37 L148.228 1081.52 L143.575 1081.52 L143.575 1073.37 L127.973 1073.37 L127.973 1068.86 L142.348 1046.96 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M159.038 1077.59 L166.677 1077.59 L166.677 1051.22 L158.366 1052.89 L158.366 1048.63 L166.63 1046.96 L171.306 1046.96 L171.306 1077.59 L178.945 1077.59 L178.945 1081.52 L159.038 1081.52 L159.038 1077.59 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M194.014 1050.04 Q190.403 1050.04 188.575 1053.6 Q186.769 1057.15 186.769 1064.28 Q186.769 1071.38 188.575 1074.95 Q190.403 1078.49 194.014 1078.49 Q197.649 1078.49 199.454 1074.95 Q201.283 1071.38 201.283 1064.28 Q201.283 1057.15 199.454 1053.6 Q197.649 1050.04 194.014 1050.04 M194.014 1046.34 Q199.825 1046.34 202.88 1050.94 Q205.959 1055.53 205.959 1064.28 Q205.959 1073 202.88 1077.61 Q199.825 1082.19 194.014 1082.19 Q188.204 1082.19 185.126 1077.61 Q182.07 1073 182.07 1064.28 Q182.07 1055.53 185.126 1050.94 Q188.204 1046.34 194.014 1046.34 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M143.945 804.882 L132.14 823.331 L143.945 823.331 L143.945 804.882 M142.718 800.808 L148.598 800.808 L148.598 823.331 L153.529 823.331 L153.529 827.22 L148.598 827.22 L148.598 835.368 L143.945 835.368 L143.945 827.22 L128.343 827.22 L128.343 822.706 L142.718 800.808 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M162.626 831.433 L178.945 831.433 L178.945 835.368 L157.001 835.368 L157.001 831.433 Q159.663 828.679 164.246 824.049 Q168.853 819.396 170.033 818.054 Q172.278 815.531 173.158 813.794 Q174.061 812.035 174.061 810.345 Q174.061 807.591 172.116 805.855 Q170.195 804.119 167.093 804.119 Q164.894 804.119 162.441 804.882 Q160.01 805.646 157.232 807.197 L157.232 802.475 Q160.056 801.341 162.51 800.762 Q164.964 800.183 167.001 800.183 Q172.371 800.183 175.565 802.869 Q178.76 805.554 178.76 810.044 Q178.76 812.174 177.95 814.095 Q177.163 815.993 175.056 818.586 Q174.477 819.257 171.376 822.475 Q168.274 825.669 162.626 831.433 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M194.014 803.887 Q190.403 803.887 188.575 807.452 Q186.769 810.993 186.769 818.123 Q186.769 825.23 188.575 828.794 Q190.403 832.336 194.014 832.336 Q197.649 832.336 199.454 828.794 Q201.283 825.23 201.283 818.123 Q201.283 810.993 199.454 807.452 Q197.649 803.887 194.014 803.887 M194.014 800.183 Q199.825 800.183 202.88 804.79 Q205.959 809.373 205.959 818.123 Q205.959 826.85 202.88 831.456 Q199.825 836.04 194.014 836.04 Q188.204 836.04 185.126 831.456 Q182.07 826.85 182.07 818.123 Q182.07 809.373 185.126 804.79 Q188.204 800.183 194.014 800.183 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M142.996 558.73 L131.191 577.179 L142.996 577.179 L142.996 558.73 M141.769 554.656 L147.649 554.656 L147.649 577.179 L152.579 577.179 L152.579 581.068 L147.649 581.068 L147.649 589.216 L142.996 589.216 L142.996 581.068 L127.394 581.068 L127.394 576.554 L141.769 554.656 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M171.815 570.582 Q175.172 571.3 177.047 573.568 Q178.945 575.837 178.945 579.17 Q178.945 584.286 175.427 587.087 Q171.908 589.888 165.427 589.888 Q163.251 589.888 160.936 589.448 Q158.644 589.031 156.191 588.175 L156.191 583.661 Q158.135 584.795 160.45 585.374 Q162.765 585.952 165.288 585.952 Q169.686 585.952 171.978 584.216 Q174.292 582.48 174.292 579.17 Q174.292 576.114 172.14 574.401 Q170.01 572.665 166.19 572.665 L162.163 572.665 L162.163 568.823 L166.376 568.823 Q169.825 568.823 171.653 567.457 Q173.482 566.068 173.482 563.476 Q173.482 560.814 171.584 559.402 Q169.709 557.966 166.19 557.966 Q164.269 557.966 162.07 558.383 Q159.871 558.8 157.232 559.679 L157.232 555.513 Q159.894 554.772 162.209 554.402 Q164.547 554.031 166.607 554.031 Q171.931 554.031 175.033 556.462 Q178.135 558.869 178.135 562.99 Q178.135 565.86 176.491 567.851 Q174.848 569.818 171.815 570.582 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M194.014 557.735 Q190.403 557.735 188.575 561.3 Q186.769 564.841 186.769 571.971 Q186.769 579.077 188.575 582.642 Q190.403 586.184 194.014 586.184 Q197.649 586.184 199.454 582.642 Q201.283 579.077 201.283 571.971 Q201.283 564.841 199.454 561.3 Q197.649 557.735 194.014 557.735 M194.014 554.031 Q199.825 554.031 202.88 558.638 Q205.959 563.221 205.959 571.971 Q205.959 580.698 202.88 585.304 Q199.825 589.888 194.014 589.888 Q188.204 589.888 185.126 585.304 Q182.07 580.698 182.07 571.971 Q182.07 563.221 185.126 558.638 Q188.204 554.031 194.014 554.031 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M141.862 312.578 L130.056 331.027 L141.862 331.027 L141.862 312.578 M140.635 308.504 L146.515 308.504 L146.515 331.027 L151.445 331.027 L151.445 334.916 L146.515 334.916 L146.515 343.064 L141.862 343.064 L141.862 334.916 L126.26 334.916 L126.26 330.402 L140.635 308.504 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M169.362 312.578 L157.556 331.027 L169.362 331.027 L169.362 312.578 M168.135 308.504 L174.015 308.504 L174.015 331.027 L178.945 331.027 L178.945 334.916 L174.015 334.916 L174.015 343.064 L169.362 343.064 L169.362 334.916 L153.76 334.916 L153.76 330.402 L168.135 308.504 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M194.014 311.583 Q190.403 311.583 188.575 315.148 Q186.769 318.689 186.769 325.819 Q186.769 332.925 188.575 336.49 Q190.403 340.032 194.014 340.032 Q197.649 340.032 199.454 336.49 Q201.283 332.925 201.283 325.819 Q201.283 318.689 199.454 315.148 Q197.649 311.583 194.014 311.583 M194.014 307.879 Q199.825 307.879 202.88 312.486 Q205.959 317.069 205.959 325.819 Q205.959 334.546 202.88 339.152 Q199.825 343.735 194.014 343.735 Q188.204 343.735 185.126 339.152 Q182.07 334.546 182.07 325.819 Q182.07 317.069 185.126 312.486 Q188.204 307.879 194.014 307.879 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M143.343 66.426 L131.538 84.875 L143.343 84.875 L143.343 66.426 M142.117 62.352 L147.996 62.352 L147.996 84.875 L152.927 84.875 L152.927 88.7639 L147.996 88.7639 L147.996 96.912 L143.343 96.912 L143.343 88.7639 L127.742 88.7639 L127.742 84.25 L142.117 62.352 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M158.042 62.352 L176.399 62.352 L176.399 66.2871 L162.325 66.2871 L162.325 74.7593 Q163.343 74.4121 164.362 74.2501 Q165.38 74.0649 166.399 74.0649 Q172.186 74.0649 175.565 77.2362 Q178.945 80.4074 178.945 85.8241 Q178.945 91.4027 175.473 94.5046 Q172.001 97.5833 165.681 97.5833 Q163.505 97.5833 161.237 97.2129 Q158.991 96.8425 156.584 96.1018 L156.584 91.4027 Q158.667 92.537 160.89 93.0926 Q163.112 93.6481 165.589 93.6481 Q169.593 93.6481 171.931 91.5416 Q174.269 89.4352 174.269 85.8241 Q174.269 82.213 171.931 80.1065 Q169.593 78 165.589 78 Q163.714 78 161.839 78.4167 Q159.987 78.8334 158.042 79.713 L158.042 62.352 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M194.014 65.4307 Q190.403 65.4307 188.575 68.9955 Q186.769 72.5371 186.769 79.6667 Q186.769 86.7731 188.575 90.3379 Q190.403 93.8796 194.014 93.8796 Q197.649 93.8796 199.454 90.3379 Q201.283 86.7731 201.283 79.6667 Q201.283 72.5371 199.454 68.9955 Q197.649 65.4307 194.014 65.4307 M194.014 61.727 Q199.825 61.727 202.88 66.3334 Q205.959 70.9167 205.959 79.6667 Q205.959 88.3935 202.88 93 Q199.825 97.5833 194.014 97.5833 Q188.204 97.5833 185.126 93 Q182.07 88.3935 182.07 79.6667 Q182.07 70.9167 185.126 66.3334 Q188.204 61.727 194.014 61.727 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M1226.92 1508.52 L1233.83 1508.52 L1247 1528.07 L1260.09 1508.52 L1266.99 1508.52 L1250.19 1533.41 L1250.19 1556.04 L1243.73 1556.04 L1243.73 1533.41 L1226.92 1508.52 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M1294.97 1536.76 L1294.97 1539.62 L1268.04 1539.62 Q1268.42 1545.67 1271.67 1548.85 Q1274.95 1552 1280.77 1552 Q1284.15 1552 1287.3 1551.17 Q1290.48 1550.35 1293.6 1548.69 L1293.6 1554.23 Q1290.45 1555.57 1287.14 1556.27 Q1283.83 1556.97 1280.42 1556.97 Q1271.89 1556.97 1266.9 1552 Q1261.93 1547.04 1261.93 1538.57 Q1261.93 1529.82 1266.64 1524.69 Q1271.38 1519.54 1279.41 1519.54 Q1286.6 1519.54 1290.77 1524.18 Q1294.97 1528.8 1294.97 1536.76 M1289.11 1535.04 Q1289.05 1530.23 1286.41 1527.37 Q1283.8 1524.5 1279.47 1524.5 Q1274.57 1524.5 1271.61 1527.27 Q1268.68 1530.04 1268.23 1535.07 L1289.11 1535.04 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M1317.31 1538.12 Q1310.22 1538.12 1307.48 1539.75 Q1304.74 1541.37 1304.74 1545.29 Q1304.74 1548.4 1306.78 1550.25 Q1308.85 1552.07 1312.38 1552.07 Q1317.25 1552.07 1320.18 1548.63 Q1323.14 1545.16 1323.14 1539.43 L1323.14 1538.12 L1317.31 1538.12 M1328.99 1535.71 L1328.99 1556.04 L1323.14 1556.04 L1323.14 1550.63 Q1321.13 1553.88 1318.14 1555.44 Q1315.15 1556.97 1310.82 1556.97 Q1305.35 1556.97 1302.1 1553.91 Q1298.88 1550.82 1298.88 1545.67 Q1298.88 1539.65 1302.9 1536.6 Q1306.94 1533.54 1314.93 1533.54 L1323.14 1533.54 L1323.14 1532.97 Q1323.14 1528.93 1320.46 1526.73 Q1317.82 1524.5 1313.02 1524.5 Q1309.96 1524.5 1307.06 1525.23 Q1304.17 1525.97 1301.49 1527.43 L1301.49 1522.02 Q1304.71 1520.78 1307.73 1520.17 Q1310.76 1519.54 1313.62 1519.54 Q1321.36 1519.54 1325.18 1523.55 Q1328.99 1527.56 1328.99 1535.71 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M1355.79 1525.87 Q1354.81 1525.3 1353.63 1525.04 Q1352.48 1524.76 1351.08 1524.76 Q1346.12 1524.76 1343.44 1528 Q1340.8 1531.22 1340.8 1537.27 L1340.8 1556.04 L1334.91 1556.04 L1334.91 1520.4 L1340.8 1520.4 L1340.8 1525.93 Q1342.65 1522.69 1345.61 1521.13 Q1348.57 1519.54 1352.8 1519.54 Q1353.41 1519.54 1354.14 1519.63 Q1354.87 1519.7 1355.76 1519.85 L1355.79 1525.87 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M42.0438 786.185 L48.314 786.185 Q46.5634 789.846 45.704 793.092 Q44.8447 796.339 44.8447 799.362 Q44.8447 804.614 46.8817 807.479 Q48.9187 810.311 52.6745 810.311 Q55.8255 810.311 57.4488 808.434 Q59.0402 806.524 60.0269 801.24 L60.8226 797.357 Q62.1912 790.164 65.6605 786.758 Q69.098 783.321 74.8908 783.321 Q81.7976 783.321 85.3624 787.968 Q88.9272 792.583 88.9272 801.527 Q88.9272 804.901 88.1633 808.72 Q87.3994 812.508 85.9035 816.582 L79.2831 816.582 Q81.4793 812.667 82.5933 808.911 Q83.7073 805.155 83.7073 801.527 Q83.7073 796.02 81.543 793.028 Q79.3786 790.037 75.3682 790.037 Q71.8671 790.037 69.8937 792.201 Q67.9204 794.333 66.9337 799.235 L66.1698 803.15 Q64.7375 810.343 61.682 813.558 Q58.6264 816.773 53.1837 816.773 Q46.8817 816.773 43.2532 812.348 Q39.6248 807.892 39.6248 800.094 Q39.6248 796.752 40.2295 793.283 Q40.8343 789.814 42.0438 786.185 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M42.2347 771.385 L52.3562 771.385 L52.3562 759.322 L56.9077 759.322 L56.9077 771.385 L76.2594 771.385 Q80.6199 771.385 81.8613 770.207 Q83.1026 768.998 83.1026 765.338 L83.1026 759.322 L88.0042 759.322 L88.0042 765.338 Q88.0042 772.117 85.4897 774.695 Q82.9434 777.273 76.2594 777.273 L56.9077 777.273 L56.9077 781.57 L52.3562 781.57 L52.3562 777.273 L42.2347 777.273 L42.2347 771.385 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M56.4621 739.366 Q56.4621 744.076 60.1542 746.813 Q63.8145 749.551 70.212 749.551 Q76.6095 749.551 80.3017 746.845 Q83.9619 744.108 83.9619 739.366 Q83.9619 734.687 80.2698 731.95 Q76.5777 729.212 70.212 729.212 Q63.8781 729.212 60.186 731.95 Q56.4621 734.687 56.4621 739.366 M51.4968 739.366 Q51.4968 731.727 56.4621 727.366 Q61.4273 723.006 70.212 723.006 Q78.9649 723.006 83.9619 727.366 Q88.9272 731.727 88.9272 739.366 Q88.9272 747.036 83.9619 751.397 Q78.9649 755.725 70.212 755.725 Q61.4273 755.725 56.4621 751.397 Q51.4968 747.036 51.4968 739.366 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M53.7248 691.209 L59.1993 691.209 Q57.8307 693.692 57.1623 696.206 Q56.4621 698.689 56.4621 701.235 Q56.4621 706.932 60.0905 710.083 Q63.6872 713.234 70.212 713.234 Q76.7369 713.234 80.3653 710.083 Q83.9619 706.932 83.9619 701.235 Q83.9619 698.689 83.2935 696.206 Q82.5933 693.692 81.2247 691.209 L86.6355 691.209 Q87.7814 693.66 88.3543 696.302 Q88.9272 698.912 88.9272 701.872 Q88.9272 709.924 83.8664 714.667 Q78.8057 719.409 70.212 719.409 Q61.491 719.409 56.4939 714.635 Q51.4968 709.829 51.4968 701.49 Q51.4968 698.784 52.0697 696.206 Q52.6108 693.628 53.7248 691.209 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M38.479 685.289 L38.479 679.401 L67.7294 679.401 L52.3562 661.927 L52.3562 654.447 L69.0344 673.353 L88.0042 653.651 L88.0042 661.29 L70.5939 679.401 L88.0042 679.401 L88.0042 685.289 L38.479 685.289 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip392)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  290.038,1310.39 390.17,1039.63 490.302,1113.47 590.434,891.934 690.566,1088.86 790.698,1015.01 890.83,744.243 990.962,842.704 1091.09,1285.78 1191.23,1138.09 
  1291.36,1064.24 1391.49,1064.24 1491.62,941.164 1591.75,1113.47 1691.89,842.704 1792.02,941.164 1892.15,916.549 1992.28,941.164 2092.41,965.78 2192.54,990.395 
  2292.68,1384.24 
  "/>
<polyline clip-path="url(#clip392)" style="stroke:#e26f46; stroke-width:4; stroke-opacity:1; fill:none" points="
  290.038,1310.39 390.17,285.795 490.302,336.362 590.434,185.419 690.566,319.529 790.698,268.9 890.83,86.1857 990.962,152.522 1091.09,454.058 1191.23,352.826 
  1291.36,303.011 1391.49,302.437 1491.62,219.75 1591.75,336.067 1691.89,152.556 1792.02,218.966 1892.15,202.424 1992.28,218.891 2092.41,236.114 2192.54,252.267 
  2292.68,522.309 
  "/>
<path clip-path="url(#clip390)" d="
M2003.87 214.069 L2352.76 214.069 L2352.76 32.6286 L2003.87 32.6286  Z
  " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"/>
<polyline clip-path="url(#clip390)" style="stroke:#000000; stroke-width:4; stroke-opacity:1; fill:none" points="
  2003.87,214.069 2352.76,214.069 2352.76,32.6286 2003.87,32.6286 2003.87,214.069 
  "/>
<polyline clip-path="url(#clip390)" style="stroke:#009af9; stroke-width:4; stroke-opacity:1; fill:none" points="
  2027.87,93.1086 2171.87,93.1086 
  "/>
<path clip-path="url(#clip390)" d="M 0 0 M2195.87 75.8286 L2217.72 75.8286 L2217.72 79.7638 L2200.54 79.7638 L2200.54 89.9952 L2217 89.9952 L2217 93.9304 L2200.54 93.9304 L2200.54 106.453 L2218.14 106.453 L2218.14 110.389 L2195.87 110.389 L2195.87 75.8286 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M2222.16 100.157 L2222.16 84.4628 L2226.42 84.4628 L2226.42 99.9952 Q2226.42 103.676 2227.86 105.528 Q2229.29 107.356 2232.16 107.356 Q2235.61 107.356 2237.6 105.157 Q2239.62 102.958 2239.62 99.1618 L2239.62 84.4628 L2243.88 84.4628 L2243.88 110.389 L2239.62 110.389 L2239.62 106.407 Q2238.07 108.768 2236.01 109.926 Q2233.97 111.06 2231.26 111.06 Q2226.79 111.06 2224.48 108.282 Q2222.16 105.504 2222.16 100.157 M2232.88 83.8378 L2232.88 83.8378 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M2248.34 74.3703 L2252.6 74.3703 L2252.6 110.389 L2248.34 110.389 L2248.34 74.3703 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M2279.25 96.3609 L2279.25 98.4442 L2259.66 98.4442 Q2259.94 102.842 2262.3 105.157 Q2264.69 107.449 2268.92 107.449 Q2271.38 107.449 2273.67 106.847 Q2275.98 106.245 2278.25 105.041 L2278.25 109.069 Q2275.96 110.041 2273.55 110.551 Q2271.14 111.06 2268.67 111.06 Q2262.46 111.06 2258.83 107.449 Q2255.22 103.838 2255.22 97.6804 Q2255.22 91.3146 2258.65 87.5878 Q2262.09 83.8378 2267.93 83.8378 Q2273.16 83.8378 2276.19 87.2174 Q2279.25 90.5739 2279.25 96.3609 M2274.99 95.1109 Q2274.94 91.6156 2273.02 89.5322 Q2271.12 87.4489 2267.97 87.4489 Q2264.41 87.4489 2262.26 89.4628 Q2260.13 91.4767 2259.8 95.1341 L2274.99 95.1109 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M2298.74 88.4443 Q2298.02 88.0276 2297.16 87.8424 Q2296.33 87.6341 2295.31 87.6341 Q2291.7 87.6341 2289.76 89.9952 Q2287.83 92.3332 2287.83 96.7313 L2287.83 110.389 L2283.55 110.389 L2283.55 84.4628 L2287.83 84.4628 L2287.83 88.4906 Q2289.18 86.1295 2291.33 84.9952 Q2293.48 83.8378 2296.56 83.8378 Q2297 83.8378 2297.53 83.9073 Q2298.07 83.9536 2298.71 84.0693 L2298.74 88.4443 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><polyline clip-path="url(#clip390)" style="stroke:#e26f46; stroke-width:4; stroke-opacity:1; fill:none" points="
  2027.87,153.589 2171.87,153.589 
  "/>
<path clip-path="url(#clip390)" d="M 0 0 M2195.87 136.309 L2225.1 136.309 L2225.1 140.244 L2212.84 140.244 L2212.84 170.869 L2208.14 170.869 L2208.14 140.244 L2195.87 140.244 L2195.87 136.309 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M2250.47 137.443 L2250.47 142.003 Q2247.81 140.73 2245.45 140.105 Q2243.09 139.48 2240.89 139.48 Q2237.07 139.48 2234.99 140.961 Q2232.93 142.443 2232.93 145.174 Q2232.93 147.466 2234.29 148.647 Q2235.68 149.804 2239.52 150.522 L2242.35 151.1 Q2247.58 152.096 2250.06 154.619 Q2252.56 157.119 2252.56 161.332 Q2252.56 166.355 2249.18 168.947 Q2245.82 171.54 2239.32 171.54 Q2236.86 171.54 2234.08 170.984 Q2231.33 170.429 2228.37 169.341 L2228.37 164.526 Q2231.21 166.123 2233.95 166.933 Q2236.68 167.744 2239.32 167.744 Q2243.32 167.744 2245.5 166.17 Q2247.67 164.596 2247.67 161.679 Q2247.67 159.133 2246.1 157.697 Q2244.55 156.262 2240.98 155.545 L2238.14 154.989 Q2232.9 153.947 2230.57 151.725 Q2228.23 149.503 2228.23 145.545 Q2228.23 140.961 2231.45 138.322 Q2234.69 135.684 2240.36 135.684 Q2242.79 135.684 2245.31 136.123 Q2247.83 136.563 2250.47 137.443 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M2257.02 144.943 L2261.28 144.943 L2261.28 170.869 L2257.02 170.869 L2257.02 144.943 M2257.02 134.85 L2261.28 134.85 L2261.28 140.244 L2257.02 140.244 L2257.02 134.85 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M2269.96 137.582 L2269.96 144.943 L2278.74 144.943 L2278.74 148.253 L2269.96 148.253 L2269.96 162.327 Q2269.96 165.498 2270.82 166.401 Q2271.7 167.304 2274.36 167.304 L2278.74 167.304 L2278.74 170.869 L2274.36 170.869 Q2269.43 170.869 2267.56 169.04 Q2265.68 167.188 2265.68 162.327 L2265.68 148.253 L2262.56 148.253 L2262.56 144.943 L2265.68 144.943 L2265.68 137.582 L2269.96 137.582 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /><path clip-path="url(#clip390)" d="M 0 0 M2283.85 136.309 L2302.21 136.309 L2302.21 140.244 L2288.14 140.244 L2288.14 148.716 Q2289.15 148.369 2290.17 148.207 Q2291.19 148.022 2292.21 148.022 Q2298 148.022 2301.38 151.193 Q2304.76 154.364 2304.76 159.781 Q2304.76 165.359 2301.28 168.461 Q2297.81 171.54 2291.49 171.54 Q2289.32 171.54 2287.05 171.17 Q2284.8 170.799 2282.39 170.058 L2282.39 165.359 Q2284.48 166.494 2286.7 167.049 Q2288.92 167.605 2291.4 167.605 Q2295.4 167.605 2297.74 165.498 Q2300.08 163.392 2300.08 159.781 Q2300.08 156.17 2297.74 154.063 Q2295.4 151.957 2291.4 151.957 Q2289.52 151.957 2287.65 152.373 Q2285.8 152.79 2283.85 153.67 L2283.85 136.309 Z" fill="#000000" fill-rule="evenodd" fill-opacity="1" /></svg>
<p>That&#39;s an average discrepancy of 30 fish! Optimising the step size in the Euler method can close this gap, but this is yet more analysis overhead we&#39;d prefer to avoid by using better solutions.</p><p>In addition, the ODE solver will be faster most of the time, regardless of how many steps it needs to take. If not, there are other, more effective solvers that can be used for your particular case.</p><h2 id="Coupling-Agents.jl-to-DifferentialEquations.jl"><a class="docs-heading-anchor" href="#Coupling-Agents.jl-to-DifferentialEquations.jl">Coupling Agents.jl to DifferentialEquations.jl</a><a id="Coupling-Agents.jl-to-DifferentialEquations.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Coupling-Agents.jl-to-DifferentialEquations.jl" title="Permalink"></a></h2><p>Perhaps you&#39;re more familiar to the <code>DifferentialEquations</code> <code>solve</code> interface and you&#39;re new to <code>Agents</code>?</p><p>We can also couple the two systems the other way. Let&#39;s use <a href="https://docs.sciml.ai/stable/features/callback_functions/#Using-Callbacks-1">callbacks</a> to handle the agent based aspects of our problem.</p><pre><code class="language-julia">function agent_cb_step!(agent, model)
    agent.yearly_catch = rand(Poisson(agent.competence))
end

function initialise_cb(; min_threshold = 60.0, nagents = 50)
    model = ABM(Fisher; properties = Dict(:min_threshold =&gt; min_threshold))

    for _ in 1:nagents
        add_agent!(model, floor(rand(truncated(LogNormal(), 1, 6))), 0.0)
    end
    model
end

modelcb = initialise_cb()</code></pre><pre><code class="language-none">AgentBasedModel with 50 agents of type Fisher
 no space
 scheduler: fastest
 properties: Dict(:min_threshold =&gt; 60.0)</code></pre><p>That&#39;s it for the <code>Agents</code> side of things! Now to build the ODE.</p><pre><code class="language-">function fish!(integrator, model)
    integrator.p[2] = integrator.u[1] &gt; model.min_threshold ?
        sum(a.yearly_catch for a in allagents(model)) : 0.0
    Agents.step!(model, agent_cb_step!, 1)
end

function fish_stock!(ds, s, p, t)
    max_population, h = p
    ds[1] = s[1] * (1 - (s[1] / max_population)) - h
end

tspan = (0.0, 20.0 * 365.0)
const initial_stock = 400.0
const max_population = 500.0

prob = OrdinaryDiffEq.ODEProblem(fish_stock!, [initial_stock], tspan, [max_population, 0.0])

# Each Dec 31st, we call fish! that adds our catch modifier to the stock, and steps the model
fish = OrdinaryDiffEq.PeriodicCallback(i -&gt; fish!(i, modelcb), 364)
# Stocks are replenished again
reset = OrdinaryDiffEq.PeriodicCallback(i -&gt; i.p[2] = 0.0, 365)

sol = OrdinaryDiffEq.solve(
    prob,
    OrdinaryDiffEq.Tsit5();
    callback = OrdinaryDiffEq.CallbackSet(fish, reset),
)

plot(
    sol(0:365:(365 * 20)),
    xticks = (0:(365 * 2):(365 * 20), 0:2:20),
    legend = false,
    ylabel = &quot;Stock&quot;,
    xlabel = &quot;Year&quot;,
)</code></pre><p>The results are different here, since the construction of this version and the one above are quite different and cannot be randomly seeded in the same manner.</p><p>However, as you can see, it is for the most part just a re-arranged implementation of the integrator method - giving users flexibility in their architecture choices.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../interact/">« Interactive application</a><a class="docs-footer-nextpage" href="../../mesa/">Comparison against Mesa (Python) »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 14 July 2020 16:11">Tuesday 14 July 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
